(()=>{var e={342:(e,t,r)=>{"use strict";var n=r(655),i=r.n(n),o=r(757),a=r.n(o),u=r(319),s=r.n(u),c=r(926),f=r.n(c),l=r(38),d=r.n(l),g=r(8),h=r.n(g),m=r(611),p=r(186);function v(e,t){return{__component:!0,element:e,dispose:t}}function x(e){return null!==e&&"object"===h()(e)&&e.__component}function y(e){var t=new FileReader;return new Promise((function(r){t.onload=function(e){var t=e.target.result;r(t)},t.readAsArrayBuffer(e)}))}function T(e){return"error"in e}var w,b,E,F,C,A,k,R=0,P="<",D="</",M=">",S="/>",L=new Set(["\r","\n"," "]),U="onClick",B="onInput",I="onKeyDown",G="onFocusOut",_="onChange",N=new Set([U,B,I,G,_]),H=new Set(["disabled"]),O=new Set(["value"]),W="children";function z(e,t){var r={type:"element",tag:"div",properties:[],bindings:[],events:[],children:[]},n=r,i=0,o=0,a=0,u=0,s=0,c=F();return c?{error:c}:{value:r};function f(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return e[i].slice(o,o+t)||""}function l(){return t[a]}function d(){a+=1}function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;o+=e,s+=e}function m(){i+=1,o=0}function p(){for(var t=e[i];o<t.length&&L.has(t[o]);)"\n"===t[o]&&(u+=1,s=0),g()}function v(){for(var t=e[i];(o<t.length||E())&&"--\x3e"!==f(3);)"\n"===t[o]&&(u+=1,s=0),E()?(m(),d(),t=e[i]):g()}function x(){for(var t=o,r=e[i];o<r.length&&!L.has(r[o])&&r[o]!==M;)g();return r.slice(t,o)}function y(){p();var e=function(){if(f()!==P)return{error:A('Error during parseElementStart: expect start of opening element "'.concat(P,'", but got "').concat(f(),'"'))};g();var e=x();n.tag=e,p();var t=function(){for(;f()!==M&&f(2)!==S;){p();var e=w();if("="!==f())return A('Error during parseAttribs: invalid char between attrib name and value; expect "=", but got "'.concat(f(),'"'));g();var t=b();if(T(t))return t.error;var r=t.value;if(N.has(e)){if("function"!=typeof r)return A('Error during parseAttribs: "'.concat(e,'" event attrib; expect value to be function, but got "').concat(h()(r),'"'));n.events.push([e,r])}else if("function"==typeof r)n.bindings.push([e,r]);else{if("number"!=typeof r&&"string"!=typeof r&&"boolean"!=typeof r)return A("Error during parseAttribs: unknown atrib value type");n.properties.push([e,r])}p()}}();if(t)return{error:t};var r=!1;if(f()===M)g();else{if(f(2)!==S)return{error:A('Error during parseElementStart: expect end of opening element "'.concat(M,'" or "').concat(S,'", but got "').concat(f(),'"'))};r=!0,g(2)}return{value:{selfClosing:r,tag:e}}}();if(T(e))return e.error;if(e.value.selfClosing)return null;var t=F();return t||(function(){if(f(2)!==D)return A('Error during parseElementEnd: expect start of closing element "'.concat(D,'", but got "').concat(f(2),'"'));g(2);var e=x();return e!==n.tag?A('Error during parseElementEnd: expect closing element to be "'.concat(n.tag,'", but got "').concat(e,'"')):(p(),f()!==M?A('Error during parseElementEnd: expect end of closing element "'.concat(M,'", but got "').concat(f(),'"')):void g())}()||void 0)}function w(){for(var t=o,r=e[i];o<r.length&&"="!==r[o]&&!L.has(r[o]);)g();return r.slice(t,o)}function b(){if('"'!==f())return{error:A("Error during parseAttribValue: value should be enclosing in '\"', but got \"".concat(f(),'"'))};if(g(),E()){var t;m();var r=l();return d(),null!==(t=u())&&void 0!==t?t:{value:r}}var n,a=function(){for(var t=o,r=e[i];o<r.length&&'"'!==r[o];)g();return r.slice(t,o)}();return null!==(n=u())&&void 0!==n?n:{value:a};function u(){if('"'!==f())return{error:A("Error during parseAttribValue: value should be enclosing in '\"', but got \"".concat(f(),'"'))};g()}}function E(){return e[i].length===o}function F(){for(;p(),void 0,s=e[i],!(o>=s.length&&i>=e.length-1);)if(E()){var t=l();if("function"==typeof t)n.bindings.push([W,t]);else{if("number"!=typeof t&&"string"!=typeof t&&"boolean"!=typeof t)return A("Error during parseChildren: unknown atrib value type");n.properties.push([W,t])}m(),d()}else if("\x3c!--"===f(4))g(4),v(),g(3);else{if(f(2)===D)break;if(f()===P){var r=n;n={type:"element",tag:void 0,properties:[],bindings:[],events:[],children:[]},r.children.push(n);var a=y();if(a)return a;n=r}else{var u=C();n.children.push({type:"text",value:u})}}var s;p()}function C(){for(var t=o,r=e[i];o<r.length&&r[o]!==P;)g();return r.slice(t,o)}function A(e){return{description:e,line:u,templatesIndex:i,column:s,valuesIndex:a}}}function X(e,t,r){var n="",i=e,o=1,a=R++,u=function(){var e=0;return function(){return e++}}();return function e(){if("text"!==i.type){var s=null,c=function(){return null===s&&(s="parsed-element-".concat(a,"-").concat(u())),"[".concat(s,"]")},f="@{reactive binding}";n+="".concat(new Array(o).join(" ")).concat(P).concat(i.tag);var l=i.bindings.filter((function(e){return d()(e,1)[0]!==W})).sort((function(e,t){var r=d()(e,1)[0],n=d()(t,1)[0];return r.charCodeAt(0)-n.charCodeAt(0)})),g=i.events.toSorted((function(e,t){var r=d()(e,1)[0],n=d()(t,1)[0];return r.charCodeAt(0)-n.charCodeAt(0)})),h=i.properties.filter((function(e){return d()(e,1)[0]!==W})).sort((function(e,t){var r=d()(e,1)[0],n=d()(t,1)[0];return r.charCodeAt(0)-n.charCodeAt(0)}));if(h.length>0){var m=h.map((function(e){var t=d()(e,2),r=t[0],n=t[1];return"".concat(r,'="').concat(String(n),'"')})).join(" ");n+=" ".concat(m)}if(i.bindings.length>0&&t)t(c,i.bindings);else if(l.length>0){var p=l.map((function(e){var t=d()(e,1)[0];return"".concat(t,'="').concat(f,'"')})).join(" ");n+=" ".concat(p)}if(g.length>0)if(r)r(c,g);else{var v=g.map((function(e){var t=d()(e,1)[0];return"".concat(t,'="').concat("@{event handler}",'"')})).join(" ");n+=" ".concat(v)}s&&(n+=" ".concat(s)),n+=M,i.children.length>0&&(n+="\n");var x=i.bindings.find((function(e){return d()(e,1)[0]===W})),y=i.properties.find((function(e){return d()(e,1)[0]===W}));x&&!t?n+=f:y?n+=String(y[1]):function(){if("text"!==i.type){o+=1;for(var t=i,r=0;r<i.children.length;r++)i=i.children[r],e(),i=t;o-=1}}(),i.children.length>0&&(n+=new Array(o).join(" ")),n+="".concat(D).concat(i.tag).concat(M),n+="\n"}else n+="".concat(new Array(o+1).join(" ")).concat(i.value,"\n")}(),n}function V(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=z(e,r);if(T(i)){for(var o=new Array(e.length+r.length),a=0;a<e.length-1;a++)o[2*a+0]=e[a],o[2*a+1]=String(r[a]);o[2*(e.length-1)+0]=e[e.length-1];var u=o.join("");console.warn("Error for template\n"+u),console.warn("html parsing error: ",i.error.description);var s=u.split("\n");if(i.error.line<s.length){var c=i.error.column-15,f=i.error.column+15;console.warn("Error at line - ".concat(i.error.line," column - ").concat(i.error.column)),0!==i.error.line&&console.warn("".concat(i.error.line-1,": ").concat(s[i.error.line-1])),console.warn("".concat(i.error.line,": ").concat(s[i.error.line].slice(0,c)+"%c"+s[i.error.line].slice(c)),"color: red"),i.error.line<s.length-1&&console.warn("".concat(i.error.line+1,": ").concat(s[i.error.line+1])),console.warn("Error at line - ".concat(s[i.error.line].slice(c,f)))}return{element:document.createElement("div"),dispose:function(){}}}var l=X(i.value),g=document.createElement("div"),h=function(){},y=[],w=[],b=[],E=function(e,t){var r=t.find((function(e){return d()(e,1)[0]===W})),n=t.filter((function(e){return d()(e,1)[0]!==W}));r&&b.push({selector:e(),child:r[1]}),n.length>0&&n.forEach((function(t){y.push({selector:e(),binding:t})}))},F=function(e,t){t.length>0&&t.forEach((function(t){w.push({selector:e(),event:t})}))},C=X(i.value,E,F);return g.innerHTML=C,(b.length>0||y.length>0||w.length)&&(0,m.Jz)((function(e){var t=function(e){x(e)&&e.dispose()},r=new Map,n=[];h=function(){n.forEach(t),e()};for(var i=function(e){var i,o=b[e],a=r.has(o.selector)?r.get(o.selector):g.querySelector(o.selector);r.set(o.selector,a),a?(0,p.cE)((i=null,function(){if(q(o.child)){var e=o.child();x(e)?(t(i),a.innerHTML="",a.appendChild(e.element)):null===e?(t(i),a.innerHTML=""):q(o.child)&&Array.isArray(e)?Array.isArray(i)?(i.filter((function(t){return-1===e.findIndex((function(e){return t===e}))})).forEach((function(e){t(e),a.removeChild(e.element)})),e.forEach((function(e){a.appendChild(e.element)}))):(t(i),a.innerHTML="",e.forEach((function(e){a.appendChild(e.element)}))):a.innerHTML=String(e),x(i)&&(n=n.filter((function(e){return e!==i}))),x(e)&&n.push(e),i=e}else a.innerHTML=String(o.child())})):(console.warn("Error during parsing template: cannot find element with id "+o.selector),console.warn("Error for template\n"+l),console.warn("Error for result template\n"+C))},o=0;o<b.length;o++)i(o);for(var a=function(e){var t=y[e],n=r.has(t.selector)?r.get(t.selector):g.querySelector(t.selector);r.set(t.selector,n),n?(0,p.cE)((function(){if(H.has(t.binding[0])){var e=t.binding[1]();e?n.setAttribute(t.binding[0],String(e)):n.removeAttribute(t.binding[0])}else if(O.has(t.binding[0])){var r=t.binding[1]();n[t.binding[0]]=String(r)}else{var i=t.binding[1]();n.setAttribute(t.binding[0],String(i))}})):console.warn("Error during parsing template: cannot find element with id "+t.selector)},u=0;u<y.length;u++)a(u);for(var s=function(e){var t=w[e],n=r.has(t.selector)?r.get(t.selector):g.querySelector(t.selector);if(r.set(t.selector,n),n){if(t.event[0]===U){var i=function(e){t.event[1](e)};n.addEventListener("click",i),(0,m.uG)((function(){return n.removeEventListener("click",i)}))}if(t.event[0]===B){var o=function(e){t.event[1](e)};n.addEventListener("input",o),(0,m.uG)((function(){return n.removeEventListener("input",o)}))}if(t.event[0]===I){var a=function(e){t.event[1](e)};n.addEventListener("keydown",a),(0,m.uG)((function(){return n.removeEventListener("keydown",a)}))}if(t.event[0]===G){var u=function(e){t.event[1](e)};n.addEventListener("focusout",u),(0,m.uG)((function(){return n.removeEventListener("focusout",u)}))}if(t.event[0]===_){var s=function(e){t.event[1](e)};n.addEventListener("change",s),(0,m.uG)((function(){return n.removeEventListener("change",s)}))}}else console.warn("Error during parsing template: cannot find element with id "+t.selector)},c=0;c<w.length;c++)s(c)})),v(g,h)}function j(e){return e.__child=!0,e}function q(e){return e.__child}function K(e,t,r){var n=new Uint8Array(e),i=1<<r,o=n.subarray(t,t+3*i);return{entriesCount:i,getRed:function(e){return n[t+(3*e+0)]},getGreen:function(e){return n[t+(3*e+1)]},getBlue:function(e){return n[t+(3*e+2)]},getColor:function(e){return{red:this.getRed(e),green:this.getGreen(e),blue:this.getBlue(e)}},getRawData:function(){return o}}}function Y(e,t){var r=new Uint8Array(e);return r[t]!==E.imageSeparator&&console.warn("Invalid image descriptor: ".concat(t,". Image desriptor doesn't start with ','")),{imageLeft:r[t+1]|r[t+2]<<8,imageTop:r[t+3]|r[t+4]<<8,imageWidth:r[t+5]|r[t+6]<<8,imageHeight:r[t+7]|r[t+8]<<8,M:r[t+9]>>7,I:r[t+9]>>6&1,pixel:1+(7&r[t+9]),compressedData:null,graphicControl:null,colorMap:null,startPointer:0}}function J(e,t){for(var r=new Uint8Array(e);r[t]&&t<r.byteLength;)t+=r[t]+1;return t+1}function $(e,t){var r=new Uint8Array(e);return{isTransparent:1&r[t],isUserInputRequired:r[t]>>>1&1,disposalMethod:r[t]>>>2&7,delayTime:10*(r[t+1]|r[t+2]<<8),transparentColorIndex:r[t+3]}}function Q(e,t){return J(e,t+=1)}function Z(e){var t=String.fromCharCode,r=new Uint8Array(e);if(r[0]===w.G&&r[1]===w.I&&r[2]===w.F){var n=10*Number(t(r[3]))+Number(t(r[4])),i="GIF".concat(n).concat(t(r[5])),o=function(e){var t=new Uint8Array(e);return 0!==t[F.start+F.size-1]&&console.warn("Invalid Screen Descriptor section: last byte should be 0"),{screenWidth:t[F.start+0]|t[F.start+1]<<8,screenHeight:t[F.start+2]|t[F.start+3]<<8,M:t[F.start+4]>>7,cr:1+((112&t[F.start+4])>>4),pixel:1+(7&t[F.start+4]),background:t[F.start+5]}}(e),a=C.start,u=null;o.M&&(a+=(u=function(e,t){return K(e,C.start,t)}(e,o.pixel)).entriesCount*C.entriesCount);for(var s=function(e,t){for(var r=new Uint8Array(e),n=[],i=null,o=null;t<r.byteLength&&-1!==t;)switch(r[t]){case b.blockLabel:if(t++,r[t++]===b.graphicControl){var a=r[t];i=$(e,t+1),t=t+a+1}else t=J(e,t);break;case E.imageSeparator:o=Y(e,t),n.push(o),t+=A.size,o.M&&(o.colorMap=K(e,t,o.pixel),t+=o.colorMap.entriesCount*C.entriesCount),i&&(o.graphicControl=i),o.compressedData=r.subarray(t,Q(e,t)),o.startPointer=t,t+=o.compressedData.byteLength;break;default:t++}return{images:n,blockEnd:t}}(e,a),c=s.images,f=s.blockEnd;f<r.length&&r[f]!==E.gifTermination;)f++;return f>r.length&&console.warn("GIF doens`t terminate with proper symbol. It may be corrapted."),{signature:i,version:n,screenDescriptor:o,colorMap:u,images:c,buffer:r}}}function ee(e){return{gif:e}}!function(e){e[e.comma=44]="comma",e[e.semicolon=59]="semicolon",e[e.G=71]="G",e[e.I=73]="I",e[e.F=70]="F"}(w||(w={})),function(e){e[e.blockLabel=33]="blockLabel",e[e.graphicControl=249]="graphicControl",e[e.applicationLabel=255]="applicationLabel"}(b||(b={})),function(e){e[e.imageSeparator=w.comma]="imageSeparator",e[e.gifTermination=w.semicolon]="gifTermination"}(E||(E={})),function(e){e[e.start=6]="start",e[e.size=7]="size"}(F||(F={})),function(e){e[e.start=F.start+F.size]="start",e[e.entriesCount=3]="entriesCount"}(C||(C={})),function(e){e[e.size=10]="size"}(A||(A={})),function(e){e[e.noAction=0]="noAction",e[e.noDispose=1]="noDispose",e[e.clear=2]="clear",e[e.prev=3]="prev"}(k||(k={}));var te=r(102),re=r.n(te);const ne=r.p+"1f220a855cd1204e55a4d8f6748d6283.wasm";function ie(e){var t,r,n,i,o,a=0;return(t=e.buffer,r=e.screenDescriptor.screenWidth*e.screenDescriptor.screenHeight,n=Math.floor((t.byteLength+r+131072)/65536)+1,i=new WebAssembly.Memory({initial:n,maximum:n}),o=new Uint8Array(i.buffer),re()({wasmMemory:i,locateFile:function(e){return e.endsWith(".wasm")?ne:e}}).then((function(e){var n=e.cwrap("lzw_uncompress","void",["number","number","number","number"]),i=e._malloc(t.byteLength),a=e._malloc(r);return o.set(t,i),{module:e,lzw_uncompress:n,gifStartPointer:i,outBuffer:o.subarray(a,a+r),outStartPointer:a}}))).then((function(e){return a=e.gifStartPointer,{lzw_uncompress:function(t){e.lzw_uncompress(a+t.startPointer,t.compressedData.length,e.outStartPointer,e.outBuffer.length)},out:e.outBuffer}}))}var oe,ae=r(575),ue=r.n(ae),se=r(913),ce=r.n(se),fe=function(){function e(){ue()(this,e),this.onceTimerId=-1}return ce()(e,[{key:"once",value:function(e,t){this.onceTimerId=setTimeout(e,t)}},{key:"clear",value:function(){return!!this.isOnceTimerSetted()&&(clearTimeout(this.onceTimerId),this.onceTimerId=-1,!0)}},{key:"isOnceTimerSetted",value:function(){return-1!==this.onceTimerId}}]),e}(),le=function(){function e(t,r){ue()(this,e),this.width=t,this.height=r,this.memory=new ImageData(t,r)}return ce()(e,[{key:"getRawMemory",value:function(){return this.memory}},{key:"setRedInPixel",value:function(e,t,r){var n=4*(t*this.width+e);this.memory.data[n+0]=r}},{key:"setGreenInPixel",value:function(e,t,r){var n=4*(t*this.width+e);this.memory.data[n+1]=r}},{key:"setBlueInPixel",value:function(e,t,r){var n=4*(t*this.width+e);this.memory.data[n+2]=r}},{key:"setAlphaInPixel",value:function(e,t,r){var n=4*(t*this.width+e);this.memory.data[n+3]=r}},{key:"set",value:function(e){this.memory.data.set(e.getRawMemory().data)}}]),e}(),de=function(){function e(t,r,n,i,o){ue()(this,e),this.ctx=t.getContext("2d"),this.uncompressedData=o.out,this.lzw_uncompress=o.lzw_uncompress,this.graphicMemory=new le(r.screenWidth,r.screenHeight),this.prevGraphicMemory=new le(r.screenWidth,r.screenHeight)}return ce()(e,[{key:"drawToTexture",value:function(e,t){var r=e.graphicControl;null!=r&&r.isTransparent?this.updateFrameData89(e,t):this.updateFrameData87(e,t)}},{key:"drawToScreen",value:function(){var e=this.graphicMemory;this.ctx.putImageData(e.getRawMemory(),0,0)}},{key:"restorePrevDisposal",value:function(){this.graphicMemory.set(this.prevGraphicMemory)}},{key:"saveDisposalPrev",value:function(){this.prevGraphicMemory.set(this.graphicMemory)}},{key:"getCanvasPixels",value:function(e){new Uint8ClampedArray(e.buffer).set(this.graphicMemory.getRawMemory().data)}},{key:"getPrevCanvasPixels",value:function(e){new Uint8ClampedArray(e.buffer).set(this.prevGraphicMemory.getRawMemory().data)}},{key:"dispose",value:function(){}},{key:"updateFrameData87",value:function(e,t){var r=this.graphicMemory,n=e.M?e.colorMap:t,i=e.imageLeft,o=e.imageTop,a=e.imageHeight,u=e.imageWidth,s=0,c=0,f=0;this.lzw_uncompress(e);for(var l=0;l<a;l++)for(var d=0;d<u;d++)f=l*u+d,s=d+i,c=l+o,r.setRedInPixel(s,c,n.getRed(this.uncompressedData[f])),r.setGreenInPixel(s,c,n.getGreen(this.uncompressedData[f])),r.setBlueInPixel(s,c,n.getBlue(this.uncompressedData[f])),r.setAlphaInPixel(s,c,255)}},{key:"updateFrameData89",value:function(e,t){var r=this.graphicMemory,n=e.M?e.colorMap:t,i=e.graphicControl,o=e.imageLeft,a=e.imageTop,u=e.imageHeight,s=e.imageWidth,c=0,f=0,l=0;this.lzw_uncompress(e);for(var d=0;d<u;d++)for(var g=0;g<s;g++)l=d*s+g,this.uncompressedData[l]!==i.transparentColorIndex&&(c=g+o,f=d+a,r.setRedInPixel(c,f,n.getRed(this.uncompressedData[l])),r.setGreenInPixel(c,f,n.getGreen(this.uncompressedData[l])),r.setBlueInPixel(c,f,n.getBlue(this.uncompressedData[l])),r.setAlphaInPixel(c,f,255))}}]),e}();function ge(e,t){switch(t){case oe.FLOAT:return e.FLOAT}return 0}function he(e,t){switch(t){case e.FLOAT:case oe.FLOAT:return Float32Array.BYTES_PER_ELEMENT}return 0}!function(e){e[e.FLOAT=0]="FLOAT"}(oe||(oe={}));var me,pe,ve,xe,ye=function(){function e(t,r){ue()(this,e),this.vbo=t.createBuffer();var n=0;if(this.layout=r.map((function(e){var r=n;return n+=he(t,e.type)*e.componentsCount,{type:ge(t,e.type),componentsCount:e.componentsCount,offset:r}})),this.stride=0,r.length){var i=this.layout[r.length-1];this.stride=i.offset+he(t,i.type)*i.componentsCount}}return ce()(e,[{key:"bind",value:function(e){e.bindBuffer(e.ARRAY_BUFFER,this.vbo)}},{key:"activateAttribPointer",value:function(e,t){t>=0&&t<this.layout.length&&(this.setAttribPointer(e,t),e.enableVertexAttribArray(t))}},{key:"activateAllAttribPointers",value:function(e){this.setAllAttribPointers(e);for(var t=0;t<this.layout.length;t++)e.enableVertexAttribArray(t)}},{key:"setData",value:function(e,t){e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)}},{key:"dispose",value:function(e){e.deleteBuffer(this.vbo)}},{key:"setAttribPointer",value:function(e,t){if(t>=0&&t<this.layout.length){var r=this.layout[t];e.vertexAttribPointer(t,r.componentsCount,r.type,!1,this.stride,r.offset)}}},{key:"setAllAttribPointers",value:function(e){for(var t=0;t<this.layout.length;t++){var r=this.layout[t];e.vertexAttribPointer(t,r.componentsCount,r.type,!1,this.stride,r.offset)}}}]),e}(),Te=[{type:oe.FLOAT,componentsCount:3},{type:oe.FLOAT,componentsCount:2}],we=(Float32Array.from([-1,1,0,0,1,1,1,0,1,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0,-1,-1,0,0,0]),Float32Array.from([-1,1,0,0,0,1,1,0,1,0,-1,-1,0,0,1,1,1,0,1,0,1,-1,0,1,1,-1,-1,0,0,1])),be=we.length/5;function Ee(e,t){switch(t){case me.NEAREST:return e.NEAREST;case me.LINEAR:return e.LINEAR}return 0}function Fe(e,t){switch(t){case pe.R8:return e.R8;case pe.RED:return e.RED;case pe.RGB:return e.RGB}return 0}function Ce(e,t){switch(t){case ve.UNSIGNED_BYTE:return e.UNSIGNED_BYTE}return 0}!function(e){e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR"}(me||(me={})),function(e){e[e.RGB=0]="RGB",e[e.R8=1]="R8",e[e.RED=2]="RED"}(pe||(pe={})),function(e){e[e.UNSIGNED_BYTE=0]="UNSIGNED_BYTE"}(ve||(ve={})),function(e){e[e.TEXTURE0=0]="TEXTURE0",e[e.TEXTURE1=1]="TEXTURE1",e[e.TEXTURE2=2]="TEXTURE2"}(xe||(xe={}));var Ae,ke={min:me.NEAREST,mag:me.NEAREST},Re={internalFormat:pe.RGB,format:pe.RGB,type:ve.UNSIGNED_BYTE},Pe={filtering:ke,imageFormat:Re},De=function(){function e(t,r,n,i){var o,a,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Pe;ue()(this,e),this.width=r,this.height=n,this.texture=t.createTexture(),this.textureUnit=xe.TEXTURE0;var s=null!==(o=null==u?void 0:u.filtering)&&void 0!==o?o:ke,c=null!==(a=null==u?void 0:u.imageFormat)&&void 0!==a?a:Re;this.config={filtering:s,imageFormat:c},t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,Ee(t,s.min)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,Ee(t,s.mag)),t.texImage2D(t.TEXTURE_2D,0,Fe(t,c.internalFormat),r,n,0,Fe(t,c.format),Ce(t,c.type),i),t.bindTexture(t.TEXTURE_2D,null)}return ce()(e,[{key:"bind",value:function(e){e.bindTexture(e.TEXTURE_2D,this.texture)}},{key:"getTextureUnit",value:function(){return this.textureUnit}},{key:"setTextureUnit",value:function(e){this.textureUnit=e}},{key:"setData",value:function(e,t,r,n,i,o){var a=this.config.imageFormat;e.texSubImage2D(e.TEXTURE_2D,0,t,r,n,i,Fe(e,a.format),Ce(e,a.type),o),this.prevDataPointer=o}},{key:"putData",value:function(e,t,r,n,i,o){if(this.prevDataPointer!==o){var a=this.config.imageFormat;e.texSubImage2D(e.TEXTURE_2D,0,t,r,n,i,Fe(e,a.format),Ce(e,a.type),o),this.prevDataPointer=o}}},{key:"getGLTexture",value:function(){return this.texture}},{key:"activeTexture",value:function(e,t){e.activeTexture(function(e,t){return e.TEXTURE0+t}(e,void 0!==t?t:this.textureUnit))}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"dispose",value:function(e){e.deleteTexture(this.texture)}}]),e}(),Me=function(){function e(){ue()(this,e)}return ce()(e,[{key:"bind",value:function(e){console.warn("A noop texture was tried to bind"),console.trace()}},{key:"getGLTexture",value:function(){return null}},{key:"activeTexture",value:function(e,t){}},{key:"getWidth",value:function(){return-1}},{key:"getHeight",value:function(){return-1}},{key:"dispose",value:function(){}}]),e}();function Se(e,t){return{texture:t,readResultToBuffer:function(r){var n=function(t){var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r);var n=e.createRenderbuffer();return e.bindRenderbuffer(e.RENDERBUFFER,n),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH24_STENCIL8,t.getWidth(),t.getHeight()),e.bindRenderbuffer(e.RENDERBUFFER,null),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.getGLTexture(),0),r}(t);e.readPixels(0,0,t.getWidth(),t.getHeight(),e.RGBA,e.UNSIGNED_BYTE,r),function(t){e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteFramebuffer(t)}(n)}}}!function(e){e[e.ScreenDrawer=0]="ScreenDrawer",e[e.FlipDrawer=1]="FlipDrawer",e[e.CopyDrawer=2]="CopyDrawer",e[e.MixDrawer=3]="MixDrawer",e[e.GifAlpha=10]="GifAlpha",e[e.GifFrame=11]="GifFrame",e[e.BlackAndWhite=100]="BlackAndWhite",e[e.Mandess=101]="Mandess",e[e.Darking=102]="Darking"}(Ae||(Ae={}));var Le=function(){function e(t,r){ue()(this,e),this.drawer=t,this.gpuProgram=r.getProgram(Ae.FlipDrawer)}return ce()(e,[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var t=e.textures,r=e.drawingTarget;return r.bind(),this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"targetTexture",t.targetTexture),this.drawer.drawTriangles(r,0,be,this.drawer.getNumberOfDrawCalls(t.targetTexture)),Se(this.drawer.getGL(),r.getBuffer())}}]),e}();function Ue(e,t,r){var n=e,i=t,o=r,a=function(){var t=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,t);var r=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,r),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH24_STENCIL8,i,o),n.bindRenderbuffer(n.RENDERBUFFER,null),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,r);var a=new De(e,i,o,null);return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a.getGLTexture(),0),n.bindFramebuffer(e.FRAMEBUFFER,null),{frameBuffer:t,texture:a,rbo:r}}(),u=a.frameBuffer,s=a.texture,c=a.rbo;return{bind:function(){n.bindFramebuffer(e.FRAMEBUFFER,u)},getBuffer:function(){return s},dispose:function(){n.bindFramebuffer(e.FRAMEBUFFER,null),n.deleteFramebuffer(u),n.deleteRenderbuffer(c),n.deleteTexture(s.getGLTexture())}}}var Be=function(){function e(t,r){ue()(this,e),this.drawer=t,this.gpuProgram=r.getProgram(Ae.ScreenDrawer)}return ce()(e,[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var t,r,n,i=e.textures,o=(t=this.drawer.getGL(),r=t,n=new Me,{bind:function(){r.bindFramebuffer(r.FRAMEBUFFER,null)},getBuffer:function(){return n},dispose:function(){}});return this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"targetTexture",i.targetTexture),this.drawer.drawTriangles(o,0,be,this.drawer.getNumberOfDrawCalls(i.targetTexture)),Se(this.drawer.getGL(),o.getBuffer())}}]),e}(),Ie=function(){function e(t,r){ue()(this,e),this.drawer=t,this.gpuProgram=r.getProgram(Ae.GifAlpha)}return ce()(e,[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var t=e.globals,r=e.textures,n=e.drawingTarget;return this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setUniform1f(this.drawer.getGL(),"TransperancyIndex",t.transperancyIndex),this.gpuProgram.setUniform1f(this.drawer.getGL(),"ScreenHeight",t.screenHeight),this.gpuProgram.setUniform4fv(this.drawer.getGL(),"Rect",t.alphaSquarCoord[0],t.alphaSquarCoord[1],t.alphaSquarCoord[2],t.alphaSquarCoord[3]),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"IndexTexture",r.gifFrame),this.drawer.drawTriangles(n,0,be,this.drawer.getNumberOfDrawCalls(r.gifFrame)),Se(this.drawer.getGL(),n.getBuffer())}}]),e}(),Ge=function(){function e(t,r){ue()(this,e),this.drawer=t,this.gpuProgram=r.getProgram(Ae.GifFrame)}return ce()(e,[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var t=e.globals,r=e.textures,n=e.drawingTarget;return this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setUniform1f(this.drawer.getGL(),"ColorTableSize",t.colorTableSize),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"IndexTexture",r.indexTexture),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"alphaTexture",r.alphaTexture),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"ColorTableTexture",r.colorTableTexture),r.prevFrameTexture&&this.gpuProgram.setTextureUniform(this.drawer.getGL(),"prevFrameTexture",r.prevFrameTexture),this.drawer.drawTriangles(n,0,be,this.drawer.getNumberOfDrawCalls(r.indexTexture)),Se(this.drawer.getGL(),n.getBuffer())}}]),e}(),_e=function(){function e(t,r){ue()(this,e),this.drawer=t,this.gpuProgram=r.getProgram(Ae.FlipDrawer)}return ce()(e,[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var t=e.textures,r=e.drawingTarget;return this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"targetTexture",t.targetTexture),this.drawer.drawTriangles(r,0,be,this.drawer.getNumberOfDrawCalls(t.targetTexture)),Se(this.drawer.getGL(),r.getBuffer())}}]),e}();function Ne(e,t){var r=[],n=[],i=-1,o={allocate:function(t,r){var i=Ue(e,t,r);return n.push(i),i},dispose:function(e){var r=n.findIndex((function(t){return t===e}));-1===r&&console.warn("".concat(t,": buffer was already disposed or never created with current allocator")),n[r]=null,n=n.filter((function(e){return null!==e})),e.dispose()}};return{startFrame:function(){a()},endFrame:function(){a()},allocateFrameDrawingTarget:function(n){r[i+=1]=[];var o={depth:i,allocate:function(n,o){this.depth!==i&&console.warn("".concat(t,": allocator should be called inside own callback"));var a=Ue(e,n,o);return r[i].push(a),a}};try{n(o),a()}catch(e){console.warn(e),a()}function a(){for(var e=0;e<r[i].length;e++)r[i][e].dispose();r[i]=[],i-=1}},getLastingAllocator:function(){return o}};function a(){for(var e=0;e<r.length;e++)for(var t=0;t<r[e].length;t++)r[e][t].dispose();r=[]}}var He=function(){function e(t,r,n){ue()(this,e),this.program=function(e,t,r){var n=e.createProgram();if(e.attachShader(n,t),e.attachShader(n,r),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS)){var i=e.getProgramInfoLog(n);return console.warn("Fail to link program: ".concat(i)),e.deleteProgram(n),null}return n}(t,r,n),this.uniformBuffer=new Map,this.currentTextureUnit=-1}return ce()(e,[{key:"isProgramCreated",value:function(){return null!==this.program}},{key:"useProgram",value:function(e){this.currentTextureUnit=-1,e.useProgram(this.program)}},{key:"setTextureUniform",value:function(e,t,r){this.currentTextureUnit+=1,r.activeTexture(e,this.currentTextureUnit),r.bind(e),this.setUniform1i(e,t,this.currentTextureUnit)}},{key:"setUniform1i",value:function(e,t,r){var n=this.getCache(e,t);n.value!==r&&(n.value=r,e.uniform1i(n.location,r))}},{key:"setUniform1f",value:function(e,t,r){var n=this.getCache(e,t);n.value!==r&&(n.value=r,e.uniform1f(n.location,r))}},{key:"setUniform3fv",value:function(e,t,r,n,i){var o=this.getCache(e,t),a=o.value;a&&(a[0]!==r||a[1],a[2]===i)||((a=new Float32Array(3))[0]=r,a[1]=n,a[2]=i,e.uniform3fv(o.location,a))}},{key:"setUniform4fv",value:function(e,t,r,n,i,o){var a=this.getCache(e,t),u=a.value;u&&(u[0]!==r||u[1],u[2],u[3]===o)||((u=new Float32Array(4))[0]=r,u[1]=n,u[2]=i,u[3]=o,a.value=u,e.uniform4fv(a.location,u))}},{key:"getCache",value:function(e,t){var r=this.uniformBuffer.get(t);return r||(r={location:e.getUniformLocation(this.program,t),value:void 0}),r}},{key:"dispose",value:function(e){e.deleteProgram(this.program),this.program=null}}]),e}();function Oe(e,t,r){var n=e.createShader(t);if(0===n&&console.warn("Fail to create shader"),e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){var i=e.getShaderInfoLog(n);return console.warn("Fail to compile shader: ".concat(i)),e.deleteShader(n),null}return n}function We(e,t){e.deleteShader(t)}const ze="#version 300 es\n\nlayout(location = 0) in vec4 vPosition;\nlayout(location = 1) in vec2 aTexCoord;\n\nout vec2 texCoord;\n\nvoid main()\n{\n  gl_Position = vPosition;\n  texCoord = aTexCoord;\n}\n",Xe="#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D targetTexture;\n\nin vec2 texCoord;\n\nout vec4 fragColor;\n\nvoid main()\n{\n  fragColor = texture(targetTexture, texCoord);\n}\n";function Ve(e,t){var r=new Map;return{getProgram:function(n){if(r.has(n))return r.get(n);var i=function(e){return e===Ae.ScreenDrawer||e===Ae.CopyDrawer||e===Ae.FlipDrawer?{vertText:ze,fragText:Xe}:e===Ae.MixDrawer?{vertText:ze,fragText:"#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D backgroundTexture;\nuniform sampler2D foregroundTexture;\n\nuniform float alpha;\n\nin vec2 texCoord;\n\nout vec4 fragColor;\n\nvoid main()\n{\n  fragColor = mix(texture(backgroundTexture, texCoord), texture(foregroundTexture, texCoord), alpha);\n}\n"}:e===Ae.BlackAndWhite?{vertText:ze,fragText:"#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D targetTexture;\n\nin vec2 texCoord;\n\nout vec4 fragColor;\n\nvoid main()\n{\n  vec4 tex = texture(targetTexture, texCoord);\n  float color = (tex.r + tex.g + tex.b) / 3.0;\n  fragColor = vec4(vec3(color), tex.a);\n}\n"}:e===Ae.GifAlpha?{vertText:ze,fragText:"#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D IndexTexture;\n\nuniform float TransperancyIndex;\nuniform float ScreenHeight;\nuniform vec4 Rect;\n\nin vec2 texCoord;\n\nout vec4 fragColor;\n\nvoid main()\n{\n  float imageLeft = Rect.x;\n  float imageTop = Rect.y;\n  float width = Rect.z;\n  float hieght = Rect.w;\n  float x = gl_FragCoord.x;\n  float y = ScreenHeight - gl_FragCoord.y;\n\n  vec4 myindex = texture(IndexTexture, texCoord);\n\n  float alpha = step(imageLeft, x) - (2.0 * step(imageLeft + width, x)) + step(imageTop, y) - (2.0 * step(imageTop + hieght, y)) - (1.0 - (step(imageLeft, x)))- (1.0 - (step(imageTop, y)));\n  // TODO: check for better the best way with performance\n  alpha = alpha * (1.0 - (step(TransperancyIndex, myindex.x * 255.0) - step(TransperancyIndex + 1.0, myindex.x * 255.0)));\n\n  fragColor = vec4(alpha, 0.0, 0.0, 1.0);   //Output the color\n}\n"}:e===Ae.GifFrame?{vertText:ze,fragText:"#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D ColorTableTexture;     //256 x 1 pixels\nuniform sampler2D IndexTexture;\nuniform sampler2D alphaTexture;\nuniform sampler2D prevFrameTexture;\nuniform float ColorTableSize;\n\nin vec2 texCoord;\n\nout vec4 fragColor;\n\nvoid main()\n{\n  vec4 myindex = texture(IndexTexture, texCoord);\n\n  float normilaziedX = (myindex.x * 255.0) / ColorTableSize;\n  vec4 texel = texture(ColorTableTexture, vec2(normilaziedX, myindex.y));\n  float alpha = texture(alphaTexture, vec2(texCoord.x, 1.0 - texCoord.y)).r;\n\n  fragColor = mix(texture(prevFrameTexture, texCoord), vec4(texel.rgb, 1.0), alpha);\n}\n"}:e===Ae.Mandess?{vertText:"#version 300 es\n\nlayout(location = 0) in vec4 vPosition;\nlayout(location = 1) in vec2 aTexCoord;\n\nout vec2 texCoord;\nout vec2 texMultCoordA;\nout vec2 texMultCoordGB;\n\nvoid main()\n{\n  gl_Position = vPosition;\n  texCoord = aTexCoord;\n  texMultCoordA = vec2(aTexCoord.x * (1.0 / 1.1), aTexCoord.y * (1.0 / 1.1));\n  texMultCoordGB = vec2(aTexCoord.x * (1.0 / 1.05) + 0.08, aTexCoord.y * (1.0 / 1.05));\n}\n",fragText:"#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D targetTexture;\n\nin vec2 texCoord;\nin vec2 texMultCoordA;\nin vec2 texMultCoordGB;\n\nout vec4 fragColor;\n\nvoid main()\n{\n  fragColor = texture(targetTexture, texCoord) * 7.0;\n  fragColor = mix(fragColor, vec4(texture(targetTexture, texMultCoordA).r, 0.0, 0.0, 1.0) * 2.0, 0.7);\n  fragColor = mix(fragColor, vec4(0.0, texture(targetTexture, texMultCoordGB).g, texture(targetTexture, texMultCoordGB).b, 1.0) * 1.5, 0.5);\n}\n"}:e===Ae.Darking?{vertText:ze,fragText:"#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D targetTexture;\nuniform float animationProgress;\nuniform float direction;\nuniform vec3 color;\n\nin vec2 texCoord;\n\nout vec4 fragColor;\n\nvoid main()\n{\n  vec4 tex = texture(targetTexture, texCoord);\n  float normilizedAnimationProgress = abs(direction - clamp(animationProgress, 0.0, 1.0));\n  vec3 _color = mix(vec3(tex.rgb), color, normilizedAnimationProgress);\n  fragColor = vec4(_color, tex.a);\n}\n"}:{vertText:"",fragText:""}}(n),o=i.vertText,a=i.fragText;if(""===o||""===a){console.warn(t,"- Unknown program id -",Ae[n]);var u={vertText:ze,fragText:Xe};o=u.vertText,a=u.fragText}var s=function(e,t){return Oe(e,e.VERTEX_SHADER,t)}(e,o),c=function(e,t){return Oe(e,e.FRAGMENT_SHADER,t)}(e,a),f=new He(e,s,c);return We(e,s),We(e,c),f.isProgramCreated()||console.warn(t,"- Program fail -",Ae[n]),r.set(n,f),f},dispose:function(){r.values().forEach((function(t){return t.dispose(e)})),r=null}}}var je=new Map;function qe(e){return je.get(e)}var Ke=-1,Ye=function(){function e(t,r,n,i,o){ue()(this,e);var a=t.getContext("webgl2");this.id=String(++Ke),function(e,t){je.set(t,{resouceManager:Ne(e,t),shaderManager:Ve(e,t)})}(a,String(this.id)),this.drawer=function(e){var t=new WeakMap;return{drawTriangles:function(r,n,i,o){r.bind(),e.drawArrays(e.TRIANGLES,n,i);var a=r.getBuffer();t.has(a)?t.set(a,o+t.get(a)+1):t.set(a,o+1)},getGL:function(){return e},startFrame:function(){t=new Map},endFrame:function(){t=new Map},getNumberOfDrawCalls:function(e){return t.has(e)?t.get(e):0}}}(a),this.drawer.startFrame();var u=n[0],s=u.M?u.colorMap:i,c=r.screenWidth,f=r.screenHeight;this.screenWidth=c,this.screenHeight=f,this.uncompressedData=o.out,this.lzw_uncompress=o.lzw_uncompress,a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),a.pixelStorei(a.UNPACK_ALIGNMENT,1),a.viewport(0,0,c,f),a.clearColor(0,0,0,1),this.vboToTexture=new ye(a,Te),this.vboToTexture.bind(a),this.vboToTexture.setData(a,we),this.vboToTexture.activateAllAttribPointers(a);var l=n.reduce((function(e,t){return t.M&&t.colorMap.entriesCount>e?t.colorMap.entriesCount:e}),s.entriesCount);this.maxColorMapSize=l,this.colorTableTexture=new De(a,l,1,null),this.gifFrameTexture=new De(a,c,f,null,{imageFormat:{internalFormat:pe.R8,format:pe.RED,type:ve.UNSIGNED_BYTE}}),this.colorTableTexture.setTextureUnit(xe.TEXTURE0),this.gifFrameTexture.setTextureUnit(xe.TEXTURE1),this.gl=a}return ce()(e,[{key:"drawToTexture",value:function(e,t){var r=this,n=this.gl;this.lzw_uncompress(e),this.gifFrameTexture.bind(n),this.gifFrameTexture.setData(n,e.imageLeft,e.imageTop,e.imageWidth,e.imageHeight,this.uncompressedData),qe(this.id).resouceManager.allocateFrameDrawingTarget((function(i){var o=r.drawToAlphaTexture(i.allocate(r.screenWidth,r.screenHeight),e),a=e.M?e.colorMap:t;r.colorTableTexture.bind(n),r.colorTableTexture.putData(n,0,0,a.entriesCount,1,a.getRawData()),r.gifFrameTexture.bind(n),r.gifFrameTexture.setData(n,e.imageLeft,e.imageTop,e.imageWidth,e.imageHeight,r.uncompressedData),r.currentFrameBuffer&&qe(r.id).resouceManager.getLastingAllocator().dispose(r.currentFrameBuffer),r.currentFrameBuffer=qe(r.id).resouceManager.getLastingAllocator().allocate(r.screenWidth,r.screenHeight),r.currentFrame=new Ge(r.drawer,qe(r.id).shaderManager).execute({memory:{},globals:{colorTableSize:r.maxColorMapSize},textures:{colorTableTexture:r.colorTableTexture,indexTexture:r.gifFrameTexture,alphaTexture:o.texture,prevFrameTexture:r.prevFrame?r.prevFrame.texture:null},drawingTarget:r.currentFrameBuffer}),r.prevFrameBuffer&&qe(r.id).resouceManager.getLastingAllocator().dispose(r.prevFrameBuffer),r.prevFrameBuffer=qe(r.id).resouceManager.getLastingAllocator().allocate(r.screenWidth,r.screenHeight),r.prevFrame=new _e(r.drawer,qe(r.id).shaderManager).execute({memory:{},globals:{},textures:{targetTexture:r.currentFrame.texture},drawingTarget:r.prevFrameBuffer})}))}},{key:"restorePrevDisposal",value:function(){this.currentFrame=this.disposalPrevFrame,this.prevFrame=this.disposalPrevFrame}},{key:"drawToScreen",value:function(e,t){var r=this;qe(this.id).resouceManager.allocateFrameDrawingTarget((function(n){var i=r.postProcessing(r.currentFrame,n,e,t);r.drawer.getNumberOfDrawCalls(i.texture)%2==1&&(i=new Le(r.drawer,qe(r.id).shaderManager).execute({memory:{},globals:{},textures:{targetTexture:i.texture},drawingTarget:n.allocate(r.screenWidth,r.screenHeight)})),new Be(r.drawer,qe(r.id).shaderManager).execute({memory:{},globals:{},textures:{targetTexture:i.texture}})})),this.drawer.endFrame(),qe(this.id).resouceManager.endFrame(),this.drawer.startFrame(),qe(this.id).resouceManager.startFrame()}},{key:"postProcessing",value:function(e,t,r,n){for(var i=e,o=0;o<r.length;o++)i=r[o].apply(this.drawer,qe(this.id).shaderManager,i,t,n);return i}},{key:"drawToAlphaTexture",value:function(e,t){var r,n={screenHeight:this.screenHeight,transperancyIndex:null!==(r=t.graphicControl)&&void 0!==r&&r.isTransparent?t.graphicControl.transparentColorIndex:512,alphaSquarCoord:[t.imageLeft,t.imageTop,t.imageWidth,t.imageHeight]};return new Ie(this.drawer,qe(this.id).shaderManager).execute({memory:{},globals:n,textures:{gifFrame:this.gifFrameTexture},drawingTarget:e})}},{key:"saveDisposalPrev",value:function(){this.disposalPrevFrameBuffer&&qe(this.id).resouceManager.getLastingAllocator().dispose(this.disposalPrevFrameBuffer),this.disposalPrevFrameBuffer=qe(this.id).resouceManager.getLastingAllocator().allocate(this.screenWidth,this.screenHeight),this.disposalPrevFrame=new _e(this.drawer,qe(this.id).shaderManager).execute({memory:{},globals:{},textures:{targetTexture:this.currentFrame.texture},drawingTarget:this.disposalPrevFrameBuffer})}},{key:"getCanvasPixels",value:function(e){this.currentFrame&&this.currentFrame.readResultToBuffer(e)}},{key:"getPrevCanvasPixels",value:function(e){this.prevFrame&&this.prevFrame.readResultToBuffer(e)}},{key:"dispose",value:function(){var e;this.vboToTexture.dispose(this.drawer.getGL()),this.currentFrame.texture.dispose(this.gl),this.disposalPrevFrame.texture.dispose(this.gl),this.prevFrame.texture.dispose(this.gl),this.gifFrameTexture.dispose(this.gl),this.colorTableTexture.dispose(this.gl),qe(this.id).resouceManager.getLastingAllocator().dispose(this.currentFrameBuffer),qe(this.id).resouceManager.getLastingAllocator().dispose(this.disposalPrevFrameBuffer),qe(this.id).resouceManager.getLastingAllocator().dispose(this.prevFrameBuffer),qe(this.id).shaderManager.dispose(),e=this.id,je.delete(e)}}]),e}(),Je=function(){function e(){ue()(this,e),this.gifs=[],this.frameSubsriptions=[],this.effectSubsriptions=[]}return ce()(e,[{key:"addGifToRender",value:function(e,t,r){var n=this,i={id:this.gifs.length},o={gifEntity:e,currentFrame:-1,algorithm:"GL"===r.algorithm?new Ye(t,e.gif.screenDescriptor,e.gif.images,e.gif.colorMap,r.uncompress):new de(t,e.gif.screenDescriptor,e.gif.images,e.gif.colorMap,r.uncompress),timer:new fe,canvas:t,effects:[]},a=o.gifEntity.gif.screenDescriptor,u=a.screenWidth,s=a.screenHeight;return o.canvas.width=u,o.canvas.height=s,o.canvas.style.width="".concat(u,"px"),o.canvas.style.height="".concat(s,"px"),this.gifs.push(o),o.gifEntity.gif.images.length?new Promise((function(e){return o.timer.once((function(){n.setFrame(i,0).then((function(){return e(i)}))}))})):Promise.resolve(i)}},{key:"addEffectToGif",value:function(e,t,r,n){t>r&&console.warn("from cannot be greater than to",t,r);var i=this.gifs[e.id];t<0&&console.warn("from should be greater than 0",t),r>=i.gifEntity.gif.images.length&&console.warn("to should be less than number of gif frames",r,i.gifEntity.gif.images.length);var o=n({screenWidth:i.gifEntity.gif.screenDescriptor.screenWidth,screenHeight:i.gifEntity.gif.screenDescriptor.screenHeight,from:t,to:r});i.effects.push(o),this.notifyEffectSubscribers(e,o,t,r)}},{key:"removeEffectFromGif",value:function(e,t){var r=this.gifs[e.id];r.effects=r.effects.filter((function(e){return e!==t})),this.notifyEffectSubscribers(e,t,t.getFrom(),t.getTo())}},{key:"setFrame",value:function(e,t){var r=this,n=this.gifs[e.id];return new Promise((function(i){t>-1&&t<n.gifEntity.gif.images.length?(n.timer.clear(),n.timer.once((function(){for(var o=Math.max(0,t<n.currentFrame?0:n.currentFrame),a=t,u=o;u<a;u++)r.drawToTexture(n,u),r.performeDisposalMethod(n,u);n.currentFrame=t,r._drawFrame(n,n.currentFrame),i(),r.notifyFrameSubscribers(e)}))):i()}))}},{key:"autoplayStart",value:function(e){var t,r=this,n=this.gifs[e.id];return n.gifEntity.gif.images.length>1&&(n.timer.once((function t(){var i,o=(n.currentFrame+1)%n.gifEntity.gif.images.length;n.timer.once(t,(null===(i=n.gifEntity.gif.images[o].graphicControl)||void 0===i?void 0:i.delayTime)||40),n.currentFrame=o,r._drawFrame(n,n.currentFrame),r.notifyFrameSubscribers(e)}),(null===(t=n.gifEntity.gif.images[n.currentFrame].graphicControl)||void 0===t?void 0:t.delayTime)||40),!0)}},{key:"autoplayEnd",value:function(e){this.gifs[e.id].timer.clear()}},{key:"onFrameRender",value:function(e,t){var r=this;return this.frameSubsriptions.push((function(r){r.gifDescription.id===e.id&&t(r)})),{clear:function(){r.frameSubsriptions=r.frameSubsriptions.filter((function(e){return e!==t}))}}}},{key:"onEffectAdded",value:function(e,t){var r=this;return this.effectSubsriptions.push((function(r){r.gifDescription.id===e.id&&t(r)})),{clear:function(){r.effectSubsriptions=r.effectSubsriptions.filter((function(e){return e!==t}))}}}},{key:"getCurrentFrame",value:function(e){return this.gifs[e.id].currentFrame}},{key:"dispose",value:function(){this.gifs.forEach((function(e){e.timer.clear(),e.algorithm.dispose()}))}},{key:"drawToTexture",value:function(e,t){var r,n=e.gifEntity.gif.images[t];e.algorithm.drawToTexture(n,e.gifEntity.gif.colorMap),(null===(r=n.graphicControl)||void 0===r?void 0:r.disposalMethod)!==k.prev&&e.algorithm.saveDisposalPrev()}},{key:"notifyFrameSubscribers",value:function(e){var t=this.gifs[e.id];this.frameSubsriptions.forEach((function(r){r({gifDescription:e,frameNumber:t.currentFrame,totalFrameNumber:t.gifEntity.gif.images.length})}))}},{key:"notifyEffectSubscribers",value:function(e,t,r,n){var i=this.gifs[e.id];this.effectSubsriptions.forEach((function(o){o({gifDescription:e,effect:t,effects:i.effects,from:r,to:n})}))}},{key:"drawToScreen",value:function(e){var t=e.effects.filter((function(t){return t.shouldBeApplied(e.currentFrame)}));e.algorithm.drawToScreen(t,e.currentFrame)}},{key:"_drawFrame",value:function(e,t){this.drawToTexture(e,t),this.drawToScreen(e),this.performeDisposalMethod(e,t)}},{key:"performeDisposalMethod",value:function(e,t){var r;(null===(r=e.gifEntity.gif.images[t].graphicControl)||void 0===r?void 0:r.disposalMethod)===k.prev&&e.algorithm.restorePrevDisposal()}}]),e}();function $e(){var e=i()(['\n      <div style="display: flex; justify-content: center;">\n        <div style="margin-right: 5px">\n          <button onClick="','">','</button>\n          <button disabled="','" onClick="','">Next</button>\n        </div>\n        <div style="border: 1px solid black">',"</div>\n      </div>\n    "]);return $e=function(){return e},e}var Qe=function(){function e(t,r){ue()(this,e),this.drawer=t,this.gpuProgram=r.getProgram(Ae.BlackAndWhite)}return ce()(e,[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var t=e.textures,r=e.drawingTarget;return this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"targetTexture",t.targetTexture),this.drawer.drawTriangles(r,0,be,this.drawer.getNumberOfDrawCalls(t.targetTexture)),Se(this.drawer.getGL(),r.getBuffer())}}]),e}(),Ze=function(){function e(t,r){ue()(this,e),this.drawer=t,this.gpuProgram=r.getProgram(Ae.Mandess)}return ce()(e,[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var t=e.textures,r=e.drawingTarget;return this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"targetTexture",t.targetTexture),this.drawer.drawTriangles(r,0,be,this.drawer.getNumberOfDrawCalls(t.targetTexture)),Se(this.drawer.getGL(),r.getBuffer())}}]),e}(),et=function(){function e(t,r){ue()(this,e),this.drawer=t,this.gpuProgram=r.getProgram(Ae.MixDrawer)}return ce()(e,[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var t=e.globals,r=e.textures,n=e.drawingTarget;this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"backgroundTexture",r.background),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"foregroundTexture",r.foreground),this.gpuProgram.setUniform1f(this.drawer.getGL(),"alpha",t.alpha);var i=this.drawer.getNumberOfDrawCalls(r.background),o=this.drawer.getNumberOfDrawCalls(r.foreground);return i%2==0&&o%2==0||i%2==1&&o%2==1||console.warn("MixRenderResultsRenderPass: foreground and background texture are flipped in different direction"),this.drawer.drawTriangles(n,0,be,t.alpha>=.5?o:i),Se(this.drawer.getGL(),n.getBuffer())}}]),e}(),tt=0;function rt(){return tt++}var nt,it=rt(),ot=rt();!function(e){e[e.out=0]="out",e[e.in=1]="in"}(nt||(nt={}));var at=function(){function e(t,r){ue()(this,e),this.drawer=t,this.gpuProgram=r.getProgram(Ae.Darking)}return ce()(e,[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var t,r=e.textures,n=e.drawingTarget,i=e.globals.color;return this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"targetTexture",r.targetTexture),this.gpuProgram.setUniform1f(this.drawer.getGL(),"animationProgress",null!==(t=e.globals.animationProgress)&&void 0!==t?t:1),this.gpuProgram.setUniform1f(this.drawer.getGL(),"direction",e.globals.direction),this.gpuProgram.setUniform3fv(this.drawer.getGL(),"color",i.r,i.g,i.b),this.drawer.drawTriangles(n,0,be,this.drawer.getNumberOfDrawCalls(r.targetTexture)),Se(this.drawer.getGL(),n.getBuffer())}}]),e}(),ut=r(205),st=r.n(ut),ct=r(585),ft=r.n(ct),lt=r(754),dt=r.n(lt),gt=r(957);var ht=function(e){st()(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=dt()(t);if(r){var i=dt()(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return ft()(this,e)});function i(){var e;return ue()(this,i),(e=n.call(this,4))[0]=0,e[1]=0,e[2]=0,e[3]=1,e}return ce()(i,[{key:"copy",value:function(){var e=new i;return e.r=this.r,e.g=this.g,e.b=this.b,e.a=this.a,e}},{key:"r",get:function(){return this[0]},set:function(e){this[0]=e}},{key:"g",get:function(){return this[1]},set:function(e){this[1]=e}},{key:"b",get:function(){return this[2]},set:function(e){this[2]=e}},{key:"a",get:function(){return this[3]},set:function(e){this[3]=e}}]),i}(r.n(gt)()(Array)),mt=function(){return new ht},pt=rt();function vt(e,t){return function(r){var n=r.target.value;if(isNaN(Number(n)))t(n);else{var i=Number(n);e(i)}}}function xt(){var e=i()(['\n            <div>\n              <span>Editing Black And White Effect</span>\n              <div>\n                <span>From</span>\n                <input onKeyDown="','" onFocusOut="','" class="from-input" value="','"/>\n              </div>\n              <div>\n                <span>To</span>\n                <input onKeyDown="','" onFocusOut="','" class="to-input" value="','"/>\n              </div>\n            </div>\n    ']);return xt=function(){return e},e}function yt(){var e=i()(['\n            <div>\n              <span>Editing Madness Effect</span>\n              <div>\n                <span>From</span>\n                <input onKeyDown="','" onFocusOut="','" class="from-input" value="','"/>\n              </div>\n              <div>\n                <span>To</span>\n                <input onKeyDown="','" onFocusOut="','" class="to-input" value="','"/>\n              </div>\n              <div>\n                <span>Alpha</span>\n                <input onKeyDown="','" onFocusOut="','" class="alpha-input" value="','"/>\n              </div>\n            </div>\n    ']);return yt=function(){return e},e}function Tt(){var e=i()(['\n            <div>\n              <span>Editing In and Out Effect</span>\n              <div>\n                <span>From</span>\n                <input onKeyDown="','" onFocusOut="','" class="from-input" value="','"/>\n              </div>\n              <div>\n                <span>To</span>\n                <input onKeyDown="','" onFocusOut="','" class="to-input" value="','"/>\n              </div>\n              <div>\n                <span>Direction</span>\n                <select name="Direction" value="','"\n                  onChange="','"\n                >\n                  <option value="in">In</option>\n                  <option value="out">Out</option>\n                </select>\n              </div>\n              <div>\n                <span>\n                  Color\n                </span>\n                <div style="display: flex">\n                  <span>\n                    <span>Red:</span>\n                    <input onKeyDown="','" onFocusOut="','" class="from-input" value="','"/>\n                  </span>\n                  <span>\n                    <span>Green:</span>\n                    <input onKeyDown="','" onFocusOut="','" class="from-input" value="','"/>\n                  </span>\n                  <span>\n                    <span>Blue:</span>\n                    <input onKeyDown="','" onFocusOut="','" class="from-input" value="','"/>\n                  </span>\n                  <span style="display: flex; align-items: end;">\n                    <span style="','"></span>\n                  </span>\n                </div>\n              </div>\n            </div>\n    ']);return Tt=function(){return e},e}function wt(){var e=i()(['<div>\n      <span>Editing is not supported for this effect</span>\n      <button onClick="','">close</button>\n  </div>']);return wt=function(){return e},e}function bt(){var e=i()(["<div>\n        <div>",'</div>\n        <button onClick="','">close</button>\n        </div>']);return bt=function(){return e},e}function Et(){var e=i()(["<div>\n        <div>",'</div>\n        <button onClick="','">close</button>\n        </div>']);return Et=function(){return e},e}function Ft(){var e=i()(["<div>\n        <div>",'</div>\n        <button onClick="','">close</button>\n        </div>']);return Ft=function(){return e},e}function Ct(e){return e===it?"Madness Effect":e===ot?"Black And White Effect":e===pt?"In And Out Effect":null}function At(){var e=i()(['\n    <div>\n        <div style="margin-bottom: 5px">\n          ','\n        </div>\n        <button\n          style="maring-right: 5px"\n          disabled="','"\n          onClick="','">\n            Add Effect\n        </button>\n        <button disabled="','" onClick="','">Remove Effect</button>\n        <div style="border-top: 1px solid black; margin-top: 5px">\n          ',"\n        </div>\n      </div>\n    "]);return At=function(){return e},e}function kt(){var e=i()(["\n      <ul>\n        ","\n      </ul>\n    "]);return kt=function(){return e},e}function Rt(){var e=i()(['<li onClick="','" style="','">\n        ',"\n      </li>"]);return Rt=function(){return e},e}var Pt=function(e,t,r,n){return"".concat(n+1,". ").concat(Ct(e)||"Unknown Effect"," - from: ").concat(t+1,"; to: ").concat(r+1)};function Dt(e){return(0,m.Jz)((function(t){var r=(0,p.td)(null),n=(0,p.td)(-1),i=null,o=[],a=[];(0,p.cE)((function(){o=e.effects().map((function(e){return(0,p.td)(e.getFrom(),{dirty:function(e,t){return!0}})})),a=e.effects().map((function(e){return(0,p.td)(e.getTo(),{dirty:function(e,t){return!0}})}))}));var u=function(){i=null,r.set(null),n.set(-1)},s=function(t,s){return V(Rt(),(function(){var c=Pt(t.getId(),o[s](),a[s](),s);if(i!==c){i=c;var f={fromValue:function(){return o[s]()},setFromValue:function(r){o[s].set(r),t.setFrom(r),e.rerender()},toValue:function(){return a[s]()},setToValue:function(r){a[s].set(r),t.setTo(r),e.rerender()},effect:t,currentFrameNumber:e.currentFrameNumber,rerender:function(){return e.rerender()}};r.set(function(e,t){return e.effect.getId()===it?V(Ft(),j((function(){return function(e){return(0,m.Jz)((function(t){var r=e.effect,n=e.fromValue,i=e.setFromValue,o=e.toValue,a=e.setToValue,u=(0,p.td)(r.getAlpha(),{dirty:function(e,t){return!0}});(0,p.cE)((function(){u(),e.rerender()}));var s=vt((function(e){e=Math.max(0,e-1),i(e)}),(function(){i(n())})),c=vt((function(e){e=Math.max(0,e-1),a(e)}),(function(){a(o())})),f=vt((function(e){e=Math.max(0,e),u.set(e),r.setAlpha(e)}),(function(){u.set(r.getAlpha())})),l=V(yt(),(function(e){"Enter"===e.key&&s(e)}),s,(function(){return n()+1}),(function(e){"Enter"===e.key&&c(e)}),c,(function(){return o()+1}),(function(e){"Enter"===e.key&&f(e)}),f,(function(){return u()}));return v(l.element,(function(){t(),l.dispose()}))}))}(e)})),t):e.effect.getId()===ot?V(Et(),j((function(){return function(e){return(0,m.Jz)((function(t){var r=e.fromValue,n=e.setFromValue,i=e.toValue,o=e.setToValue,a=vt((function(e){e=Math.max(0,e-1),n(e)}),(function(){n(r())})),u=vt((function(e){e=Math.max(0,e-1),o(e)}),(function(){o(i())})),s=V(xt(),(function(e){"Enter"===e.key&&a(e)}),a,(function(){return r()+1}),(function(e){"Enter"===e.key&&u(e)}),u,(function(){return i()+1}));return v(s.element,(function(){t(),s.dispose()}))}))}(e)})),t):function(e){return e.getId()===pt}(e.effect)?V(bt(),j((function(){return function(e){return(0,m.Jz)((function(t){var r,n=e.fromValue,i=e.setFromValue,o=e.toValue,a=e.setToValue,u=e.rerender,s=e.effect,c=(0,p.td)(s.getDirection(),{dirty:function(e,t){return!0}}),f=(0,p.td)(255*s.getColor().r,{dirty:function(e,t){return!0}}),l=(0,p.td)(255*s.getColor().g,{dirty:function(e,t){return!0}}),d=(0,p.td)(255*s.getColor().b,{dirty:function(e,t){return!0}}),g=vt((function(e){e=Math.max(0,e-1),i(e)}),(function(){i(n())})),h=vt((function(e){e=Math.max(0,e-1),a(e)}),(function(){a(o())})),m=(r=function(e){c.set("in"===e?nt.in:nt.out),s.setDirection(c()),u()},function(e){var t=e.target.value;r(t)}),x=vt((function(e){e=Math.min(Math.max(0,e),255),f.set(e),s.getColor().r=e/255,u()}),(function(){f.set(f())})),y=vt((function(e){e=Math.min(Math.max(0,e),255),l.set(e),s.getColor().g=e/255,u()}),(function(){l.set(l())})),T=vt((function(e){e=Math.min(Math.max(0,e),255),d.set(e),s.getColor().b=e/255,u()}),(function(){d.set(d())})),w=V(Tt(),(function(e){"Enter"===e.key&&g(e)}),g,(function(){return n()+1}),(function(e){"Enter"===e.key&&h(e)}),h,(function(){return o()+1}),(function(){return c()===nt.in?"in":"out"}),m,(function(e){"Enter"===e.key&&x(e)}),x,(function(){return f()}),(function(e){"Enter"===e.key&&y(e)}),y,(function(){return l()}),(function(e){"Enter"===e.key&&T(e)}),T,(function(){return d()}),(function(){return"display: inline-block; width: 50px; height: 30px; background-color: rgb(".concat(f(),", ").concat(l(),", ").concat(d(),")")}));return v(w.element,(function(){t(),w.dispose()}))}))}(e)})),t):V(wt(),t)}(f,u)),n.set(s)}}),(function(){return(t.shouldBeApplied(e.currentFrameNumber()-1)?"color: green":"")+"; "+(r=s,(n()===r?"background-color: #a9dcf3":"")+"; cursor: pointer;");var r}),Pt(t.getId(),o[s](),a[s](),s))},c=V(At(),j((function(){return 0===e.effects().length?"No effects":V(kt(),j((function(){return e.effects().map(s)})))})),(function(){return!e.isEffectSelectedToAdd()}),(function(){return e.addSelectedEffect()}),(function(){return-1===n()}),(function(){return e.removeSelectedEffect(n()),void u()}),j((function(){return r()})));return v(c.element,(function(){t(),c.dispose()}))}))}function Mt(){var e=i()(['\n      <div style="border-bottom: 1px solid black; padding-top: 5px;">\n        <div style="position: relative; display: flex; justify-content: center; margin-bottom: 5px;">\n            <canvas></canvas>\n          <div style="position: absolute; top: 0; right: 5px;">\n            <button onClick="','">close</button>\n          </div>\n        </div>\n        <div>\n          <div style="border-bottom: 1px solid black">',"</div>\n          <div>","</div>\n        </div>\n      </div>\n    "]);return Mt=function(){return e},e}function St(e){return(0,m.Jz)((function(t){var r=V(Mt(),(function(){return e.onClose()}),j((function(){return function(e){return(0,m.Jz)((function(t){var r=(0,p.td)(!1),n=V($e(),(function(){return e.isPlay.set((function(e){return!e}))}),(function(){return e.isPlay()?"Stop":"Play"}),(function(){return e.isPlay()}),(function(){r()||(r.set(!0),e.renderNext()().then((function(){return r.set(!1)})))}),(function(){return"".concat(e.currentFrameNumber()," / ").concat(e.totalFrameNumber())}));return v(n.element,(function(){t(),n.dispose()}))}))}(e)})),j((function(){return Dt(e)}))),n=v(r.element,(function(){t(),r.dispose()}));return n.getCanvas=function(){return r.element.querySelector("canvas")},n}))}function Lt(){var e=i()(['<li\n                  style="','"\n                  onClick="','"\n                >\n                  ',"\n              </li>"]);return Lt=function(){return e},e}function Ut(){var e=i()(['\n      <div style="border: 1px solid black;">\n        <span>Select Effect:</span>\n        <ul style="padding: 0; padding-left: 15px;">\n            ',"\n        </ul>\n      </div>\n    "]);return Ut=function(){return e},e}function Bt(){var e=i()(['\n      <div>\n        <div>\n            <input type="file" onChange="','" />\n        </div>\n        <div style="display: flex">\n            <div style="min-width: 80%; border: 1px solid black;">','</div>\n            <div style="width: 100%; height: 100%; position: sticky; top: 0">',"</div>\n        </div>\n      </div>\n    "]);return Bt=function(){return e},e}var It,Gt,_t,Nt,Ht,Ot,Wt,zt=document.getElementById("main");Wt=(It=[],Gt=(0,p.td)([]),_t=(0,p.td)(null),Nt=function(e){_t.set(e)},Ht=function(e){return e===it?function(e){return function(e){var t=.7;return{apply:function(r,n,i,o){var a=i,u=new Qe(r,n).execute({memory:{},globals:{},textures:{targetTexture:a.texture},drawingTarget:o.allocate(e.screenWidth,e.screenHeight)}),s=new Ze(r,n).execute({memory:{},globals:{},textures:{targetTexture:a.texture},drawingTarget:o.allocate(e.screenWidth,e.screenHeight)});return new et(r,n).execute({memory:{},globals:{alpha:t},textures:{background:u.texture,foreground:s.texture},drawingTarget:o.allocate(e.screenWidth,e.screenHeight)})},shouldBeApplied:function(t){return t>=e.from&&t<=e.to},getId:function(){return it},getFrom:function(){return e.from},getTo:function(){return e.to},setFrom:function(t){e.from=t},setTo:function(t){e.to=t},getAlpha:function(){return t},setAlpha:function(e){t=e}}}(e)}:e===pt?function(e){return function(e,t){var r,n;return t.direction=null!==(r=t.direction)&&void 0!==r?r:nt.in,t.color=null!==(n=t.color)&&void 0!==n?n:mt(),{apply:function(r,n,i,o,a){var u=function(e,t,r){return t<=e?1:(r-e)/Math.max(t-e,1)}(e.from,e.to,a),s=i;return new at(r,n).execute({memory:{},globals:{animationProgress:u,direction:t.direction,color:t.color},textures:{targetTexture:s.texture},drawingTarget:o.allocate(e.screenWidth,e.screenHeight)})},shouldBeApplied:function(t){return t>=e.from&&t<=e.to},getId:function(){return pt},getFrom:function(){return e.from},setFrom:function(t){e.from=t},getTo:function(){return e.to},setTo:function(t){e.to=t},getDirection:function(){return t.direction},setDirection:function(e){t.direction=e},getColor:function(){return t.color},setColor:function(e){t.color=e}}}(e,{direction:nt.in,color:mt()})}:e===ot?function(e){return function(e){return{apply:function(t,r,n,i){var o=n;return new Qe(t,r).execute({memory:{},globals:{},textures:{targetTexture:o.texture},drawingTarget:i.allocate(e.screenWidth,e.screenHeight)})},shouldBeApplied:function(t){return t>=e.from&&t<=e.to},getId:function(){return ot},getFrom:function(){return e.from},setFrom:function(t){e.from=t},getTo:function(){return e.to},setTo:function(t){e.to=t}}}(e)}:null},Ot=function(){var e=f()(a().mark((function e(t){var r,n,i,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.target.files.item(0),e.next=3,y(r);case 3:n=e.sent,(i=Z(n))&&(o=ee(i),It.push(o),(0,m.Jz)(function(){var e=f()(a().mark((function e(t){var r,n,i,u,c,f,l,d,g,h,m,v;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Je,e.next=3,ie(o.gif);case 3:return n=e.sent,i=function(){},u=function(){},c=(0,p.td)(!1),f=(0,p.td)(1),l=(0,p.td)(o.gif.images.length),d=(0,p.td)([]),g=(0,p.td)((function(){return Promise.resolve()})),h=function(e){r.removeEffectFromGif(v,d()[e])},m=St({isPlay:c,renderNext:g,currentFrameNumber:f,totalFrameNumber:l,effects:d,rerender:function(){return u()},onClose:function(){return i()},removeSelectedEffect:h,isEffectSelectedToAdd:function(){return null!==_t()},addSelectedEffect:function(){var e=Ht(_t());r.addEffectToGif(v,0,1,(function(t){return e(t)}))}}),i=function(){r.dispose(),t(),Gt.set(Gt().filter((function(e){return e!==m}))),It=It.filter((function(e){return e!==o}))},Gt.set(Gt().concat(m)),e.next=17,r.addGifToRender(o,m.getCanvas(),{uncompress:n,algorithm:"GL"});case 17:v=e.sent,u=function(){c()||r.setFrame(v,r.getCurrentFrame(v))},r.onEffectAdded(v,(function(e){d.set(s()(e.effects))})),r.onFrameRender(v,(function(e){f.set(e.frameNumber+1)})),(0,p.cE)((function(){c()?r.autoplayStart(v)||console.warn("Error to stop"):r.autoplayEnd(v)})),c.set(!0),g.set((function(){return function(){return r.setFrame(v,(r.getCurrentFrame(v)+1)%o.gif.images.length)}}));case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(0,m.Jz)((function(e){var t=V(Bt(),Ot,j((function(){return Gt()})),j((function(){return function(e){var t=e.selectedEffect,r=e.selectEffect,n=(0,p.td)([ot,it,pt]);return(0,m.Jz)((function(e){var i=V(Ut(),j((function(){return n().map((function(e){return V(Lt(),(function(){return(t()===e?"background-color: green; ":"")+"cursor: pointer"}),(function(){return r(e)}),Ct(e))}))})));return v(i.element,(function(){e(),i.dispose()}))}))}({selectedEffect:_t,selectEffect:Nt})})));return v(t.element,(function(){e(),t.dispose()}))}))),zt.appendChild(Wt.element)},102:e=>{var t,r=(t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var r,n,i=void 0!==(e=e||{})?e:{},o=Object.assign;i.ready=new Promise((function(e,t){r=e,n=t}));var a=o({},i),u=[],s="";"undefined"!=typeof document&&document.currentScript&&(s=document.currentScript.src),t&&(s=t),s=0!==s.indexOf("blob:")?s.substr(0,s.replace(/[?#].*/,"").lastIndexOf("/")+1):"",i.print||console.log.bind(console);var c,f,l=i.printErr||console.warn.bind(console);o(i,a),a=null,i.arguments&&(u=i.arguments),i.thisProgram&&i.thisProgram,i.quit&&i.quit,i.wasmBinary&&(c=i.wasmBinary),i.noExitRuntime,"object"!=typeof WebAssembly&&D("no native wasm support detected");var d=!1;function g(e){return i["_"+e]}function h(e,t,r,n,i){var o={string:function(e){var t=0;if(null!=e&&0!==e){var r=1+(e.length<<2);!function(e,t,r){!function(e,t,r,n){if(!(n>0))return 0;for(var i=r+n-1,o=0;o<e.length;++o){var a=e.charCodeAt(o);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++o)),a<=127){if(r>=i)break;t[r++]=a}else if(a<=2047){if(r+1>=i)break;t[r++]=192|a>>6,t[r++]=128|63&a}else if(a<=65535){if(r+2>=i)break;t[r++]=224|a>>12,t[r++]=128|a>>6&63,t[r++]=128|63&a}else{if(r+3>=i)break;t[r++]=240|a>>18,t[r++]=128|a>>12&63,t[r++]=128|a>>6&63,t[r++]=128|63&a}}t[r]=0}(e,v,t,r)}(e,t=O(r),r)}return t},array:function(e){var t=O(e.length);return function(e,t){p.set(e,t)}(e,t),t}};var a=g(e),u=[],s=0;if(n)for(var c=0;c<n.length;c++){var f=o[r[c]];f?(0===s&&(s=N()),u[c]=f(n[c])):u[c]=n[c]}var l=a.apply(null,u);return function(e){return 0!==s&&H(s),function(e){return"string"===t?(r=e)?function(e,t,r){for(var n=t+void 0,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.subarray&&x)return x.decode(e.subarray(t,i));for(var o="";t<i;){var a=e[t++];if(128&a){var u=63&e[t++];if(192!=(224&a)){var s=63&e[t++];if((a=224==(240&a)?(15&a)<<12|u<<6|s:(7&a)<<18|u<<12|s<<6|63&e[t++])<65536)o+=String.fromCharCode(a);else{var c=a-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&a)<<6|u)}else o+=String.fromCharCode(a)}return o}(v,r):"":"boolean"===t?Boolean(e):e;var r}(e)}(l)}var m,p,v,x="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function y(e){m=e,i.HEAP8=p=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=new Int32Array(e),i.HEAPU8=v=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}var T,w=i.INITIAL_MEMORY||65536;(f=i.wasmMemory?i.wasmMemory:new WebAssembly.Memory({initial:w/65536,maximum:32768}))&&(m=f.buffer),w=m.byteLength,y(m);var b,E,F=[],C=[],A=[],k=0,R=null,P=null;function D(e){i.onAbort&&i.onAbort(e),l(e="Aborted("+e+")"),d=!0,e+=". Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw n(t),t}function M(e){return e.startsWith("data:application/octet-stream;base64,")}function S(e){try{if(e==b&&c)return new Uint8Array(c);throw"both async and sync fetching of the wasm failed"}catch(e){D(e)}}function L(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?B(r)():B(r)(t.arg):r(void 0===t.arg?null:t.arg)}else t(i)}}i.preloadedImages={},i.preloadedAudios={},M(b="out.wasm")||(E=b,b=i.locateFile?i.locateFile(E,s):s+E);var U=[];function B(e){var t=U[e];return t||(e>=U.length&&(U.length=e+1),U[e]=t=T.get(e)),t}function I(e){try{return f.grow(e-m.byteLength+65535>>>16),y(f.buffer),1}catch(e){}}var G,_={b:function(e){var t,r=v.length,n=2147483648;if((e>>>=0)>n)return!1;for(var i=1;i<=4;i*=2){var o=r*(1+.2/i);if(o=Math.min(o,e+100663296),I(Math.min(n,((t=Math.max(e,o))%65536>0&&(t+=65536-t%65536),t))))return!0}return!1},a:f},N=(function(){var e={a:_};function t(e,t){var r,n=e.exports;i.asm=n,T=i.asm.f,r=i.asm.c,C.unshift(r),function(e){if(k--,i.monitorRunDependencies&&i.monitorRunDependencies(k),0==k&&(null!==R&&(clearInterval(R),R=null),P)){var t=P;P=null,t()}}()}function r(e){t(e.instance)}function o(t){return(c||"function"!=typeof fetch?Promise.resolve().then((function(){return S(b)})):fetch(b,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+b+"'";return e.arrayBuffer()})).catch((function(){return S(b)}))).then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){l("failed to asynchronously prepare wasm: "+e),D(e)}))}if(k++,i.monitorRunDependencies&&i.monitorRunDependencies(k),i.instantiateWasm)try{return i.instantiateWasm(e,t)}catch(e){return l("Module.instantiateWasm callback failed with error: "+e),!1}(c||"function"!=typeof WebAssembly.instantiateStreaming||M(b)||"function"!=typeof fetch?o(r):fetch(b,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){return l("wasm streaming compile failed: "+e),l("falling back to ArrayBuffer instantiation"),o(r)}))}))).catch(n)}(),i.___wasm_call_ctors=function(){return(i.___wasm_call_ctors=i.asm.c).apply(null,arguments)},i._lzw_uncompress=function(){return(i._lzw_uncompress=i.asm.d).apply(null,arguments)},i._malloc=function(){return(i._malloc=i.asm.e).apply(null,arguments)},i.stackSave=function(){return(N=i.stackSave=i.asm.g).apply(null,arguments)}),H=i.stackRestore=function(){return(H=i.stackRestore=i.asm.h).apply(null,arguments)},O=i.stackAlloc=function(){return(O=i.stackAlloc=i.asm.i).apply(null,arguments)};function W(e){function t(){G||(G=!0,i.calledRun=!0,d||(L(C),r(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),A.unshift(e);var e;L(A)}()))}e=e||u,k>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),F.unshift(e);var e;L(F)}(),k>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t()))}if(i.cwrap=function(e,t,r,n){var i=(r=r||[]).every((function(e){return"number"===e}));return"string"!==t&&i&&!n?g(e):function(){return h(e,t,r,arguments)}},P=function e(){G||W(),G||(P=e)},i.run=W,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return W(),e.ready});e.exports=r}},t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.m=e,r.x=e=>{},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{var e={179:0},t=[[342,736]],n=e=>{},i=(i,o)=>{for(var a,u,[s,c,f,l]=o,d=0,g=[];d<s.length;d++)u=s[d],r.o(e,u)&&e[u]&&g.push(e[u][0]),e[u]=0;for(a in c)r.o(c,a)&&(r.m[a]=c[a]);for(f&&f(r),i&&i(o);g.length;)g.shift()();return l&&t.push.apply(t,l),n()},o=self.webpackChunkcustom_gif=self.webpackChunkcustom_gif||[];function a(){for(var n,i=0;i<t.length;i++){for(var o=t[i],a=!0,u=1;u<o.length;u++){var s=o[u];0!==e[s]&&(a=!1)}a&&(t.splice(i--,1),n=r(r.s=o[0]))}return 0===t.length&&(r.x(),r.x=e=>{}),n}o.forEach(i.bind(null,0)),o.push=i.bind(null,o.push.bind(o));var u=r.x;r.x=()=>(r.x=u||(e=>{}),(n=a)())})(),r.x()})();