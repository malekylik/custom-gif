(()=>{var e,r={487:e=>{var r,t=(r="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var t,n,a=void 0!==(e=e||{})?e:{},i=Object.assign;a.ready=new Promise((function(e,r){t=e,n=r}));var o=i({},a),u=[],s="";"undefined"!=typeof document&&document.currentScript&&(s=document.currentScript.src),r&&(s=r),s=0!==s.indexOf("blob:")?s.substr(0,s.replace(/[?#].*/,"").lastIndexOf("/")+1):"",a.print||console.log.bind(console);var c,l,f=a.printErr||console.warn.bind(console);i(a,o),o=null,a.arguments&&(u=a.arguments),a.thisProgram&&a.thisProgram,a.quit&&a.quit,a.wasmBinary&&(c=a.wasmBinary),a.noExitRuntime,"object"!=typeof WebAssembly&&M("no native wasm support detected");var g=!1;function m(e){return a["_"+e]}function d(e,r,t,n,a){var i={string:function(e){var r=0;if(null!=e&&0!==e){var t=1+(e.length<<2);!function(e,r,t){!function(e,r,t,n){if(!(n>0))return 0;for(var a=t+n-1,i=0;i<e.length;++i){var o=e.charCodeAt(i);if(o>=55296&&o<=57343&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++i)),o<=127){if(t>=a)break;r[t++]=o}else if(o<=2047){if(t+1>=a)break;r[t++]=192|o>>6,r[t++]=128|63&o}else if(o<=65535){if(t+2>=a)break;r[t++]=224|o>>12,r[t++]=128|o>>6&63,r[t++]=128|63&o}else{if(t+3>=a)break;r[t++]=240|o>>18,r[t++]=128|o>>12&63,r[t++]=128|o>>6&63,r[t++]=128|63&o}}r[t]=0}(e,v,r,t)}(e,r=O(t),t)}return r},array:function(e){var r=O(e.length);return function(e,r){p.set(e,r)}(e,r),r}};var o=m(e),u=[],s=0;if(n)for(var c=0;c<n.length;c++){var l=i[t[c]];l?(0===s&&(s=N()),u[c]=l(n[c])):u[c]=n[c]}var f=o.apply(null,u);return function(e){return 0!==s&&H(s),function(e){return"string"===r?(t=e)?function(e,r){for(var t=r+void 0,n=r;e[n]&&!(n>=t);)++n;if(n-r>16&&e.subarray&&T)return T.decode(e.subarray(r,n));for(var a="";r<n;){var i=e[r++];if(128&i){var o=63&e[r++];if(192!=(224&i)){var u=63&e[r++];if((i=224==(240&i)?(15&i)<<12|o<<6|u:(7&i)<<18|o<<12|u<<6|63&e[r++])<65536)a+=String.fromCharCode(i);else{var s=i-65536;a+=String.fromCharCode(55296|s>>10,56320|1023&s)}}else a+=String.fromCharCode((31&i)<<6|o)}else a+=String.fromCharCode(i)}return a}(v,t):"":"boolean"===r?Boolean(e):e;var t}(e)}(f)}var h,p,v,T="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function x(e){h=e,a.HEAP8=p=new Int8Array(e),a.HEAP16=new Int16Array(e),a.HEAP32=new Int32Array(e),a.HEAPU8=v=new Uint8Array(e),a.HEAPU16=new Uint16Array(e),a.HEAPU32=new Uint32Array(e),a.HEAPF32=new Float32Array(e),a.HEAPF64=new Float64Array(e)}var w,y=a.INITIAL_MEMORY||65536;(l=a.wasmMemory?a.wasmMemory:new WebAssembly.Memory({initial:y/65536,maximum:32768}))&&(h=l.buffer),y=h.byteLength,x(h);var b,E,F=[],A=[],R=[],C=0,P=null,D=null;function M(e){a.onAbort&&a.onAbort(e),f(e="Aborted("+e+")"),g=!0,e+=". Build with -s ASSERTIONS=1 for more info.";var r=new WebAssembly.RuntimeError(e);throw n(r),r}function k(e){return e.startsWith("data:application/octet-stream;base64,")}function U(e){try{if(e==b&&c)return new Uint8Array(c);throw"both async and sync fetching of the wasm failed"}catch(e){M(e)}}function S(e){for(;e.length>0;){var r=e.shift();if("function"!=typeof r){var t=r.func;"number"==typeof t?void 0===r.arg?B(t)():B(t)(r.arg):t(void 0===r.arg?null:r.arg)}else r(a)}}a.preloadedImages={},a.preloadedAudios={},k(b="out.wasm")||(E=b,b=a.locateFile?a.locateFile(E,s):s+E);var L=[];function B(e){var r=L[e];return r||(e>=L.length&&(L.length=e+1),L[e]=r=w.get(e)),r}function I(e){try{return l.grow(e-h.byteLength+65535>>>16),x(l.buffer),1}catch(e){}}var G,_={b:function(e){var r,t=v.length,n=2147483648;if((e>>>=0)>n)return!1;for(var a=1;a<=4;a*=2){var i=t*(1+.2/a);if(i=Math.min(i,e+100663296),I(Math.min(n,((r=Math.max(e,i))%65536>0&&(r+=65536-r%65536),r))))return!0}return!1},a:l},N=(function(){var e={a:_};function r(e,r){var t,n=e.exports;a.asm=n,w=a.asm.f,t=a.asm.c,A.unshift(t),function(){if(C--,a.monitorRunDependencies&&a.monitorRunDependencies(C),0==C&&(null!==P&&(clearInterval(P),P=null),D)){var e=D;D=null,e()}}()}function t(e){r(e.instance)}function i(r){return(c||"function"!=typeof fetch?Promise.resolve().then((function(){return U(b)})):fetch(b,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+b+"'";return e.arrayBuffer()})).catch((function(){return U(b)}))).then((function(r){return WebAssembly.instantiate(r,e)})).then((function(e){return e})).then(r,(function(e){f("failed to asynchronously prepare wasm: "+e),M(e)}))}if(C++,a.monitorRunDependencies&&a.monitorRunDependencies(C),a.instantiateWasm)try{return a.instantiateWasm(e,r)}catch(e){return f("Module.instantiateWasm callback failed with error: "+e),!1}(c||"function"!=typeof WebAssembly.instantiateStreaming||k(b)||"function"!=typeof fetch?i(t):fetch(b,{credentials:"same-origin"}).then((function(r){return WebAssembly.instantiateStreaming(r,e).then(t,(function(e){return f("wasm streaming compile failed: "+e),f("falling back to ArrayBuffer instantiation"),i(t)}))}))).catch(n)}(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.c).apply(null,arguments)},a._lzw_uncompress=function(){return(a._lzw_uncompress=a.asm.d).apply(null,arguments)},a._malloc=function(){return(a._malloc=a.asm.e).apply(null,arguments)},a.stackSave=function(){return(N=a.stackSave=a.asm.g).apply(null,arguments)}),H=a.stackRestore=function(){return(H=a.stackRestore=a.asm.h).apply(null,arguments)},O=a.stackAlloc=function(){return(O=a.stackAlloc=a.asm.i).apply(null,arguments)};function W(e){function r(){G||(G=!0,a.calledRun=!0,g||(S(A),t(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),function(){if(a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;)e=a.postRun.shift(),R.unshift(e);var e;S(R)}()))}e=e||u,C>0||(function(){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)e=a.preRun.shift(),F.unshift(e);var e;S(F)}(),C>0||(a.setStatus?(a.setStatus("Running..."),setTimeout((function(){setTimeout((function(){a.setStatus("")}),1),r()}),1)):r()))}if(a.cwrap=function(e,r,t,n){var a=(t=t||[]).every((function(e){return"number"===e}));return"string"!==r&&a&&!n?m(e):function(){return d(e,r,t,arguments)}},D=function e(){G||W(),G||(D=e)},a.run=W,a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return W(),e.ready});e.exports=t},674:(e,r,t)=>{"use strict";var n=function(e){return e[e.comma=44]="comma",e[e.semicolon=59]="semicolon",e[e.G=71]="G",e[e.I=73]="I",e[e.F=70]="F",e}({}),a=function(e){return e[e.blockLabel=33]="blockLabel",e[e.graphicControl=249]="graphicControl",e[e.applicationLabel=255]="applicationLabel",e}({}),i=function(e){return e[e.imageSeparator=44]="imageSeparator",e[e.gifTermination=59]="gifTermination",e}({}),o=function(e){return e[e.start=6]="start",e[e.size=7]="size",e}({}),u=function(e){return e[e.start=13]="start",e[e.entriesCount=3]="entriesCount",e}({}),s=function(e){return e[e.size=10]="size",e}({});function c(e,r,t){var n=new Uint8Array(e),a=1<<t,i=n.subarray(r,r+3*a);return{entriesCount:a,getRed:function(e){return n[r+(3*e+0)]},getGreen:function(e){return n[r+(3*e+1)]},getBlue:function(e){return n[r+(3*e+2)]},getColor:function(e){return{red:this.getRed(e),green:this.getGreen(e),blue:this.getBlue(e)}},getRawData:function(){return i}}}function l(e,r){var t=new Uint8Array(e);return t[r]!==i.imageSeparator&&console.warn("Invalid image descriptor: ".concat(r,". Image desriptor doesn't start with ','")),{imageLeft:t[r+1]|t[r+2]<<8,imageTop:t[r+3]|t[r+4]<<8,imageWidth:t[r+5]|t[r+6]<<8,imageHeight:t[r+7]|t[r+8]<<8,M:t[r+9]>>7,I:t[r+9]>>6&1,pixel:1+(7&t[r+9]),compressedData:null,graphicControl:null,colorMap:null,startPointer:0}}function f(e,r){for(var t=new Uint8Array(e);t[r]&&r<t.byteLength;)r+=t[r]+1;return r+1}var g=function(e){return e[e.noAction=0]="noAction",e[e.noDispose=1]="noDispose",e[e.clear=2]="clear",e[e.prev=3]="prev",e}({});function m(e,r){var t=new Uint8Array(e);return{isTransparent:1&t[r],isUserInputRequired:t[r]>>>1&1,disposalMethod:t[r]>>>2&7,delayTime:10*(t[r+1]|t[r+2]<<8),transparentColorIndex:t[r+3]}}function d(e,r){return f(e,r+=1)}var h=t(29),p=t(212),v=function(){return(0,p.A)((function e(){(0,h.A)(this,e),this.onceTimerId=-1}),[{key:"once",value:function(e,r){this.onceTimerId=setTimeout(e,r)}},{key:"clear",value:function(){return!!this.isOnceTimerSetted()&&(clearTimeout(this.onceTimerId),this.onceTimerId=-1,!0)}},{key:"isOnceTimerSetted",value:function(){return-1!==this.onceTimerId}}])}(),T=function(){return(0,p.A)((function e(r,t){(0,h.A)(this,e),this.width=r,this.height=t,this.memory=new ImageData(r,t)}),[{key:"getRawMemory",value:function(){return this.memory}},{key:"setRedInPixel",value:function(e,r,t){var n=4*(r*this.width+e);this.memory.data[n+0]=t}},{key:"setGreenInPixel",value:function(e,r,t){var n=4*(r*this.width+e);this.memory.data[n+1]=t}},{key:"setBlueInPixel",value:function(e,r,t){var n=4*(r*this.width+e);this.memory.data[n+2]=t}},{key:"setAlphaInPixel",value:function(e,r,t){var n=4*(r*this.width+e);this.memory.data[n+3]=t}},{key:"set",value:function(e){this.memory.data.set(e.getRawMemory().data)}}])}(),x=function(){return(0,p.A)((function e(r,t,n,a,i){(0,h.A)(this,e),this.ctx=r.getContext("2d"),this.uncompressedData=i.out,this.lzw_uncompress=i.lzw_uncompress,this.graphicMemory=new T(t.screenWidth,t.screenHeight),this.prevGraphicMemory=new T(t.screenWidth,t.screenHeight)}),[{key:"drawToTexture",value:function(e,r){var t=e.graphicControl;null!=t&&t.isTransparent?this.updateFrameData89(e,r):this.updateFrameData87(e,r)}},{key:"drawToScreen",value:function(){var e=this.graphicMemory;this.ctx.putImageData(e.getRawMemory(),0,0)}},{key:"restorePrevDisposal",value:function(){this.graphicMemory.set(this.prevGraphicMemory)}},{key:"saveDisposalPrev",value:function(){this.prevGraphicMemory.set(this.graphicMemory)}},{key:"getCanvasPixels",value:function(e){new Uint8ClampedArray(e.buffer).set(this.graphicMemory.getRawMemory().data)}},{key:"getPrevCanvasPixels",value:function(e){new Uint8ClampedArray(e.buffer).set(this.prevGraphicMemory.getRawMemory().data)}},{key:"updateFrameData87",value:function(e,r){var t=this.graphicMemory,n=e.M?e.colorMap:r,a=e.imageLeft,i=e.imageTop,o=e.imageHeight,u=e.imageWidth,s=0,c=0,l=0;this.lzw_uncompress(e);for(var f=0;f<o;f++)for(var g=0;g<u;g++)l=f*u+g,s=g+a,c=f+i,t.setRedInPixel(s,c,n.getRed(this.uncompressedData[l])),t.setGreenInPixel(s,c,n.getGreen(this.uncompressedData[l])),t.setBlueInPixel(s,c,n.getBlue(this.uncompressedData[l])),t.setAlphaInPixel(s,c,255)}},{key:"updateFrameData89",value:function(e,r){var t=this.graphicMemory,n=e.M?e.colorMap:r,a=e.graphicControl,i=e.imageLeft,o=e.imageTop,u=e.imageHeight,s=e.imageWidth,c=0,l=0,f=0;this.lzw_uncompress(e);for(var g=0;g<u;g++)for(var m=0;m<s;m++)f=g*s+m,this.uncompressedData[f]!==a.transparentColorIndex&&(c=m+i,l=g+o,t.setRedInPixel(c,l,n.getRed(this.uncompressedData[f])),t.setGreenInPixel(c,l,n.getGreen(this.uncompressedData[f])),t.setBlueInPixel(c,l,n.getBlue(this.uncompressedData[f])),t.setAlphaInPixel(c,l,255))}}])}(),w=function(e){return e[e.FLOAT=0]="FLOAT",e}({});function y(e,r){return r===w.FLOAT?e.FLOAT:0}function b(e,r){switch(r){case e.FLOAT:case w.FLOAT:return Float32Array.BYTES_PER_ELEMENT}return 0}var E=function(){return(0,p.A)((function e(r,t){(0,h.A)(this,e),this.vbo=r.createBuffer();var n=0;if(this.layout=t.map((function(e){var t=n;return n+=b(r,e.type)*e.componentsCount,{type:y(r,e.type),componentsCount:e.componentsCount,offset:t}})),this.stride=0,t.length){var a=this.layout[t.length-1];this.stride=a.offset+b(r,a.type)*a.componentsCount}}),[{key:"bind",value:function(e){e.bindBuffer(e.ARRAY_BUFFER,this.vbo)}},{key:"activateAttribPointer",value:function(e,r){r>=0&&r<this.layout.length&&(this.setAttribPointer(e,r),e.enableVertexAttribArray(r))}},{key:"activateAllAttribPointers",value:function(e){this.setAllAttribPointers(e);for(var r=0;r<this.layout.length;r++)e.enableVertexAttribArray(r)}},{key:"setData",value:function(e,r){e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW)}},{key:"setAttribPointer",value:function(e,r){if(r>=0&&r<this.layout.length){var t=this.layout[r];e.vertexAttribPointer(r,t.componentsCount,t.type,!1,this.stride,t.offset)}}},{key:"setAllAttribPointers",value:function(e){for(var r=0;r<this.layout.length;r++){var t=this.layout[r];e.vertexAttribPointer(r,t.componentsCount,t.type,!1,this.stride,t.offset)}}}])}(),F=[{type:w.FLOAT,componentsCount:3},{type:w.FLOAT,componentsCount:2}],A=(Float32Array.from([-1,1,0,0,1,1,1,0,1,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0,-1,-1,0,0,0]),Float32Array.from([-1,1,0,0,0,1,1,0,1,0,-1,-1,0,0,1,1,1,0,1,0,1,-1,0,1,1,-1,-1,0,0,1])),R=A.length/5,C=function(e){return e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e}({}),P=function(e){return e[e.RGB=0]="RGB",e[e.R8=1]="R8",e[e.RED=2]="RED",e}({}),D=function(e){return e[e.UNSIGNED_BYTE=0]="UNSIGNED_BYTE",e}({}),M=function(e){return e[e.TEXTURE0=0]="TEXTURE0",e[e.TEXTURE1=1]="TEXTURE1",e[e.TEXTURE2=2]="TEXTURE2",e}({});function k(e,r){switch(r){case C.NEAREST:return e.NEAREST;case C.LINEAR:return e.LINEAR}return 0}function U(e,r){switch(r){case P.R8:return e.R8;case P.RED:return e.RED;case P.RGB:return e.RGB}return 0}function S(e,r){return r===D.UNSIGNED_BYTE?e.UNSIGNED_BYTE:0}var L={min:C.NEAREST,mag:C.NEAREST},B={internalFormat:P.RGB,format:P.RGB,type:D.UNSIGNED_BYTE},I={filtering:L,imageFormat:B},G=function(){return(0,p.A)((function e(r,t,n,a){var i,o,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:I;(0,h.A)(this,e),this.width=t,this.height=n,this.texture=r.createTexture(),this.textureUnit=M.TEXTURE0;var s=null!==(i=null==u?void 0:u.filtering)&&void 0!==i?i:L,c=null!==(o=null==u?void 0:u.imageFormat)&&void 0!==o?o:B;this.config={filtering:s,imageFormat:c},r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,k(r,s.min)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,k(r,s.mag)),r.texImage2D(r.TEXTURE_2D,0,U(r,c.internalFormat),t,n,0,U(r,c.format),S(r,c.type),a),r.bindTexture(r.TEXTURE_2D,null)}),[{key:"bind",value:function(e){e.bindTexture(e.TEXTURE_2D,this.texture)}},{key:"getTextureUnit",value:function(){return this.textureUnit}},{key:"setTextureUnit",value:function(e){this.textureUnit=e}},{key:"setData",value:function(e,r,t,n,a,i){var o=this.config.imageFormat;e.texSubImage2D(e.TEXTURE_2D,0,r,t,n,a,U(e,o.format),S(e,o.type),i),this.prevDataPointer=i}},{key:"putData",value:function(e,r,t,n,a,i){if(this.prevDataPointer!==i){var o=this.config.imageFormat;e.texSubImage2D(e.TEXTURE_2D,0,r,t,n,a,U(e,o.format),S(e,o.type),i),this.prevDataPointer=i}}},{key:"getGLTexture",value:function(){return this.texture}},{key:"activeTexture",value:function(e,r){e.activeTexture(function(e,r){return e.TEXTURE0+r}(e,void 0!==r?r:this.textureUnit))}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}}])}(),_=function(){return(0,p.A)((function e(){(0,h.A)(this,e)}),[{key:"bind",value:function(e){console.warn("A noop texture was tried to bind"),console.trace()}},{key:"getGLTexture",value:function(){return null}},{key:"activeTexture",value:function(e,r){}},{key:"getWidth",value:function(){return-1}},{key:"getHeight",value:function(){return-1}}])}();function N(e,r){return{texture:r,readResultToBuffer:function(t){var n=function(r){var t=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);var n=e.createRenderbuffer();return e.bindRenderbuffer(e.RENDERBUFFER,n),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH24_STENCIL8,r.getWidth(),r.getHeight()),e.bindRenderbuffer(e.RENDERBUFFER,null),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r.getGLTexture(),0),t}(r);e.readPixels(0,0,r.getWidth(),r.getHeight(),e.RGBA,e.UNSIGNED_BYTE,t),function(r){e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteFramebuffer(r)}(n)}}}var H=function(e){return e[e.ScreenDrawer=0]="ScreenDrawer",e[e.FlipDrawer=1]="FlipDrawer",e[e.CopyDrawer=2]="CopyDrawer",e[e.MixDrawer=3]="MixDrawer",e[e.GifAlpha=10]="GifAlpha",e[e.GifFrame=11]="GifFrame",e[e.BlackAndWhite=100]="BlackAndWhite",e[e.Mandess=101]="Mandess",e}({}),O=function(){return(0,p.A)((function e(r,t){(0,h.A)(this,e),this.drawer=r,this.gpuProgram=t.getProgram(H.FlipDrawer)}),[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var r=e.textures,t=e.drawingTarget;return t.bind(),this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"targetTexture",r.targetTexture),this.drawer.drawTriangles(t,0,R,this.drawer.getNumberOfDrawCalls(r.targetTexture)),N(this.drawer.getGL(),t.getBuffer())}}])}();function W(e,r,t){var n=e,a=r,i=t,o=function(){var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r);var t=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,t),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH24_STENCIL8,a,i),n.bindRenderbuffer(n.RENDERBUFFER,null),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t);var o=new G(e,a,i,null);return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o.getGLTexture(),0),n.bindFramebuffer(e.FRAMEBUFFER,null),{frameBuffer:r,texture:o,rbo:t}}(),u=o.frameBuffer,s=o.texture,c=o.rbo;return{bind:function(){n.bindFramebuffer(e.FRAMEBUFFER,u)},getBuffer:function(){return s},dispose:function(){n.bindFramebuffer(e.FRAMEBUFFER,null),n.deleteFramebuffer(u),n.deleteRenderbuffer(c),n.deleteTexture(s.getGLTexture())}}}var z=function(){return(0,p.A)((function e(r,t){(0,h.A)(this,e),this.drawer=r,this.gpuProgram=t.getProgram(H.ScreenDrawer)}),[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var r,t,n,a=e.textures,i=(r=this.drawer.getGL(),t=r,n=new _,{bind:function(){t.bindFramebuffer(t.FRAMEBUFFER,null)},getBuffer:function(){return n},dispose:function(){}});return this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"targetTexture",a.targetTexture),this.drawer.drawTriangles(i,0,R,this.drawer.getNumberOfDrawCalls(a.targetTexture)),N(this.drawer.getGL(),i.getBuffer())}}])}(),X=function(){return(0,p.A)((function e(r,t){(0,h.A)(this,e),this.drawer=r,this.gpuProgram=t.getProgram(H.GifAlpha)}),[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var r=e.globals,t=e.textures,n=e.drawingTarget;return this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setUniform1f(this.drawer.getGL(),"TransperancyIndex",r.transperancyIndex),this.gpuProgram.setUniform1f(this.drawer.getGL(),"ScreenHeight",r.screenHeight),this.gpuProgram.setUniform1fv(this.drawer.getGL(),"Rect",r.alphaSquarCoord[0],r.alphaSquarCoord[1],r.alphaSquarCoord[2],r.alphaSquarCoord[3]),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"IndexTexture",t.gifFrame),this.drawer.drawTriangles(n,0,R,this.drawer.getNumberOfDrawCalls(t.gifFrame)),N(this.drawer.getGL(),n.getBuffer())}}])}(),Y=function(){return(0,p.A)((function e(r,t){(0,h.A)(this,e),this.drawer=r,this.gpuProgram=t.getProgram(H.GifFrame)}),[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var r=e.globals,t=e.textures,n=e.drawingTarget;return this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setUniform1f(this.drawer.getGL(),"ColorTableSize",r.colorTableSize),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"IndexTexture",t.indexTexture),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"alphaTexture",t.alphaTexture),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"ColorTableTexture",t.colorTableTexture),t.prevFrameTexture&&this.gpuProgram.setTextureUniform(this.drawer.getGL(),"prevFrameTexture",t.prevFrameTexture),this.drawer.drawTriangles(n,0,R,this.drawer.getNumberOfDrawCalls(t.indexTexture)),N(this.drawer.getGL(),n.getBuffer())}}])}(),q=function(){return(0,p.A)((function e(r,t){(0,h.A)(this,e),this.drawer=r,this.gpuProgram=t.getProgram(H.FlipDrawer)}),[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var r=e.textures,t=e.drawingTarget;return this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"targetTexture",r.targetTexture),this.drawer.drawTriangles(t,0,R,this.drawer.getNumberOfDrawCalls(r.targetTexture)),N(this.drawer.getGL(),t.getBuffer())}}])}(),j=function(){return(0,p.A)((function e(r,t){(0,h.A)(this,e),this.drawer=r,this.gpuProgram=t.getProgram(H.BlackAndWhite)}),[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var r=e.textures,t=e.drawingTarget;return this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"targetTexture",r.targetTexture),this.drawer.drawTriangles(t,0,R,this.drawer.getNumberOfDrawCalls(r.targetTexture)),N(this.drawer.getGL(),t.getBuffer())}}])}(),V=function(){return(0,p.A)((function e(r,t){(0,h.A)(this,e),this.drawer=r,this.gpuProgram=t.getProgram(H.Mandess)}),[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var r=e.textures,t=e.drawingTarget;return this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"targetTexture",r.targetTexture),this.drawer.drawTriangles(t,0,R,this.drawer.getNumberOfDrawCalls(r.targetTexture)),N(this.drawer.getGL(),t.getBuffer())}}])}(),$=function(){return(0,p.A)((function e(r,t){(0,h.A)(this,e),this.drawer=r,this.gpuProgram=t.getProgram(H.MixDrawer)}),[{key:"chain",value:function(e){throw new Error("Method not implemented.")}},{key:"execute",value:function(e){var r=e.globals,t=e.textures,n=e.drawingTarget;this.gpuProgram.useProgram(this.drawer.getGL()),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"backgroundTexture",t.background),this.gpuProgram.setTextureUniform(this.drawer.getGL(),"foregroundTexture",t.foreground),this.gpuProgram.setUniform1f(this.drawer.getGL(),"alpha",r.alpha);var a=this.drawer.getNumberOfDrawCalls(t.background),i=this.drawer.getNumberOfDrawCalls(t.foreground);return a%2==0&&i%2==0||a%2==1&&i%2==1||console.warn("MixRenderResultsRenderPass: foreground and background texture are flipped in different direction"),this.drawer.drawTriangles(n,0,R,r.alpha>=.5?i:a),N(this.drawer.getGL(),n.getBuffer())}}])}();function K(e,r){var t=[],n=[],a=-1,i={allocate:function(r,t){var a=W(e,r,t);return n.push(a),a},dispose:function(e){var t=n.findIndex((function(r){return r===e}));-1===t&&console.warn("".concat(r,": buffer was already disposed or never created with current allocator")),n[t]=null,n=n.filter((function(e){return null!==e})),e.dispose()}};return{startFrame:function(){o()},endFrame:function(){o()},allocateFrameDrawingTarget:function(n){t[a+=1]=[];var i={depth:a,allocate:function(n,i){this.depth!==a&&console.warn("".concat(r,": allocator should be called inside own callback"));var o=W(e,n,i);return t[a].push(o),o}};try{n(i),o()}catch(e){console.warn(e),o()}function o(){for(var e=0;e<t[a].length;e++)t[a][e].dispose();t[a]=[],a-=1}},getLastingAllocator:function(){return i}};function o(){for(var e=0;e<t.length;e++)for(var r=0;r<t[e].length;r++)t[e][r].dispose();t=[]}}var J=function(){return(0,p.A)((function e(r,t,n){(0,h.A)(this,e),this.program=function(e,r,t){var n=e.createProgram();if(e.attachShader(n,r),e.attachShader(n,t),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS)){var a=e.getProgramInfoLog(n);return console.warn("Fail to link program: ".concat(a)),e.deleteProgram(n),null}return n}(r,t,n),this.uniformBuffer=new Map,this.currentTextureUnit=-1}),[{key:"isProgramCreated",value:function(){return null!==this.program}},{key:"useProgram",value:function(e){this.currentTextureUnit=-1,e.useProgram(this.program)}},{key:"setTextureUniform",value:function(e,r,t){this.currentTextureUnit+=1,t.activeTexture(e,this.currentTextureUnit),t.bind(e),this.setUniform1i(e,r,this.currentTextureUnit)}},{key:"setUniform1i",value:function(e,r,t){var n=this.getCache(e,r);n.value!==t&&(n.value=t,e.uniform1i(n.location,t))}},{key:"setUniform1f",value:function(e,r,t){var n=this.getCache(e,r);n.value!==t&&(n.value=t,e.uniform1f(n.location,t))}},{key:"setUniform1fv",value:function(e,r,t,n,a,i){var o=this.getCache(e,r),u=o.value;u&&(u[0]!==t||u[1],u[2],u[3]===i)||((u=new Float32Array(4))[0]=t,u[1]=n,u[2]=a,u[3]=i,o.value=u,e.uniform4fv(o.location,u))}},{key:"getCache",value:function(e,r){var t=this.uniformBuffer.get(r);return t||(t={location:e.getUniformLocation(this.program,r),value:void 0}),t}},{key:"dispose",value:function(e){e.deleteProgram(this.program),this.program=null}}])}();function Q(e,r,t){var n=e.createShader(r);if(0===n&&console.warn("Fail to create shader"),e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(n);return console.warn("Fail to compile shader: ".concat(a)),e.deleteShader(n),null}return n}function Z(e,r){e.deleteShader(r)}const ee="#version 300 es\r\n\r\nlayout(location = 0) in vec4 vPosition;\r\nlayout(location = 1) in vec2 aTexCoord;\r\n\r\nout vec2 texCoord;\r\n\r\nvoid main()\r\n{\r\n  gl_Position = vPosition;\r\n  texCoord = aTexCoord;\r\n}\r\n",re="#version 300 es\r\n\r\nprecision mediump float;\r\n\r\nuniform sampler2D targetTexture;\r\n\r\nin vec2 texCoord;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n  fragColor = texture(targetTexture, texCoord);\r\n}\r\n";function te(e,r){var t=new Map;return{getProgram:function(n){if(t.has(n))return t.get(n);var a=function(e){return e===H.ScreenDrawer||e===H.CopyDrawer||e===H.FlipDrawer?{vertText:ee,fragText:re}:e===H.MixDrawer?{vertText:ee,fragText:"#version 300 es\r\n\r\nprecision mediump float;\r\n\r\nuniform sampler2D backgroundTexture;\r\nuniform sampler2D foregroundTexture;\r\n\r\nuniform float alpha;\r\n\r\nin vec2 texCoord;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n  fragColor = mix(texture(backgroundTexture, texCoord), texture(foregroundTexture, texCoord), alpha);\r\n}\r\n"}:e===H.BlackAndWhite?{vertText:ee,fragText:"#version 300 es\r\n\r\nprecision mediump float;\r\n\r\nuniform sampler2D targetTexture;\r\n\r\nin vec2 texCoord;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n  vec4 tex = texture(targetTexture, texCoord);\r\n  float color = (tex.r + tex.g + tex.b) / 3.0;\r\n  fragColor = vec4(vec3(color), tex.a);\r\n}\r\n"}:e===H.GifAlpha?{vertText:ee,fragText:"#version 300 es\r\n\r\nprecision mediump float;\r\n\r\nuniform sampler2D IndexTexture;\r\n\r\nuniform float TransperancyIndex;\r\nuniform float ScreenHeight;\r\nuniform vec4 Rect;\r\n\r\nin vec2 texCoord;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n  float imageLeft = Rect.x;\r\n  float imageTop = Rect.y;\r\n  float width = Rect.z;\r\n  float hieght = Rect.w;\r\n  float x = gl_FragCoord.x;\r\n  float y = ScreenHeight - gl_FragCoord.y;\r\n\r\n  vec4 myindex = texture(IndexTexture, texCoord);\r\n\r\n  float alpha = step(imageLeft, x) - (2.0 * step(imageLeft + width, x)) + step(imageTop, y) - (2.0 * step(imageTop + hieght, y)) - (1.0 - (step(imageLeft, x)))- (1.0 - (step(imageTop, y)));\r\n  // TODO: check for better the best way with performance\r\n  alpha = alpha * (1.0 - (step(TransperancyIndex, myindex.x * 255.0) - step(TransperancyIndex + 1.0, myindex.x * 255.0)));\r\n\r\n  fragColor = vec4(alpha, 0.0, 0.0, 1.0);   //Output the color\r\n}\r\n"}:e===H.GifFrame?{vertText:ee,fragText:"#version 300 es\r\n\r\nprecision mediump float;\r\n\r\nuniform sampler2D ColorTableTexture;     //256 x 1 pixels\r\nuniform sampler2D IndexTexture;\r\nuniform sampler2D alphaTexture;\r\nuniform sampler2D prevFrameTexture;\r\nuniform float ColorTableSize;\r\n\r\nin vec2 texCoord;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n  vec4 myindex = texture(IndexTexture, texCoord);\r\n\r\n  float normilaziedX = (myindex.x * 255.0) / ColorTableSize;\r\n  vec4 texel = texture(ColorTableTexture, vec2(normilaziedX, myindex.y));\r\n  float alpha = texture(alphaTexture, vec2(texCoord.x, 1.0 - texCoord.y)).r;\r\n\r\n  fragColor = mix(texture(prevFrameTexture, texCoord), vec4(texel.rgb, 1.0), alpha);\r\n}\r\n"}:e===H.Mandess?{vertText:"#version 300 es\r\n\r\nlayout(location = 0) in vec4 vPosition;\r\nlayout(location = 1) in vec2 aTexCoord;\r\n\r\nout vec2 texCoord;\r\nout vec2 texMultCoordA;\r\nout vec2 texMultCoordGB;\r\n\r\nvoid main()\r\n{\r\n  gl_Position = vPosition;\r\n  texCoord = aTexCoord;\r\n  texMultCoordA = vec2(aTexCoord.x * (1.0 / 1.1), aTexCoord.y * (1.0 / 1.1));\r\n  texMultCoordGB = vec2(aTexCoord.x * (1.0 / 1.05) + 0.08, aTexCoord.y * (1.0 / 1.05));\r\n}\r\n",fragText:"#version 300 es\r\n\r\nprecision mediump float;\r\n\r\nuniform sampler2D targetTexture;\r\n\r\nin vec2 texCoord;\r\nin vec2 texMultCoordA;\r\nin vec2 texMultCoordGB;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main()\r\n{\r\n  fragColor = texture(targetTexture, texCoord) * 7.0;\r\n  fragColor = mix(fragColor, vec4(texture(targetTexture, texMultCoordA).r, 0.0, 0.0, 1.0) * 2.0, 0.7);\r\n  fragColor = mix(fragColor, vec4(0.0, texture(targetTexture, texMultCoordGB).g, texture(targetTexture, texMultCoordGB).b, 1.0) * 1.5, 0.5);\r\n}\r\n"}:{vertText:"",fragText:""}}(n),i=a.vertText,o=a.fragText;if(""===i||""===o){console.warn(r,"- Unknown program id -",H[n]);var u={vertText:ee,fragText:re};i=u.vertText,o=u.fragText}var s=function(e,r){return Q(e,e.VERTEX_SHADER,r)}(e,i),c=function(e,r){return Q(e,e.FRAGMENT_SHADER,r)}(e,o),l=new J(e,s,c);return Z(e,s),Z(e,c),l.isProgramCreated()||console.warn(r,"- Program fail -",H[n]),t.set(n,l),l},dispose:function(){t.values().forEach((function(r){return r.dispose(e)}))}}}var ne=new Map;function ae(e){return ne.get(e)}var ie=-1,oe=function(){return(0,p.A)((function e(r,t,n,a,i){(0,h.A)(this,e);var o=r.getContext("webgl2");this.id=String(++ie),function(e,r){ne.set(r,{resouceManager:K(e,r),shaderManager:te(e,r)})}(o,String(this.id)),this.drawer=function(e){var r=new WeakMap;return{drawTriangles:function(t,n,a,i){t.bind(),e.drawArrays(e.TRIANGLES,n,a);var o=t.getBuffer();r.has(o)?r.set(o,i+r.get(o)+1):r.set(o,i+1)},getGL:function(){return e},startFrame:function(){r=new Map},endFrame:function(){r=new Map},getNumberOfDrawCalls:function(e){return r.has(e)?r.get(e):0}}}(o),this.drawer.startFrame();var u=n[0],s=u.M?u.colorMap:a,c=t.screenWidth,l=t.screenHeight;this.screenWidth=c,this.screenHeight=l,this.uncompressedData=i.out,this.lzw_uncompress=i.lzw_uncompress,o.enable(o.BLEND),o.blendEquation(o.FUNC_ADD),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.pixelStorei(o.UNPACK_ALIGNMENT,1),o.viewport(0,0,c,l),o.clearColor(0,0,0,1),this.vboToTexture=new E(o,F),this.vboToTexture.bind(o),this.vboToTexture.setData(o,A),this.vboToTexture.activateAllAttribPointers(o);var f=n.reduce((function(e,r){return r.M&&r.colorMap.entriesCount>e?r.colorMap.entriesCount:e}),s.entriesCount);this.maxColorMapSize=f,this.colorTableTexture=new G(o,f,1,null),this.gifFrameTexture=new G(o,c,l,null,{imageFormat:{internalFormat:P.R8,format:P.RED,type:D.UNSIGNED_BYTE}}),this.colorTableTexture.setTextureUnit(M.TEXTURE0),this.gifFrameTexture.setTextureUnit(M.TEXTURE1),this.gl=o}),[{key:"drawToTexture",value:function(e,r){var t=this,n=this.gl;this.lzw_uncompress(e),this.gifFrameTexture.bind(n),this.gifFrameTexture.setData(n,e.imageLeft,e.imageTop,e.imageWidth,e.imageHeight,this.uncompressedData),ae(this.id).resouceManager.allocateFrameDrawingTarget((function(a){var i=t.drawToAlphaTexture(a.allocate(t.screenWidth,t.screenHeight),e),o=e.M?e.colorMap:r;t.colorTableTexture.bind(n),t.colorTableTexture.putData(n,0,0,o.entriesCount,1,o.getRawData()),t.gifFrameTexture.bind(n),t.gifFrameTexture.setData(n,e.imageLeft,e.imageTop,e.imageWidth,e.imageHeight,t.uncompressedData),t.currentFrameBuffer&&ae(t.id).resouceManager.getLastingAllocator().dispose(t.currentFrameBuffer),t.currentFrameBuffer=ae(t.id).resouceManager.getLastingAllocator().allocate(t.screenWidth,t.screenHeight),t.currentFrame=new Y(t.drawer,ae(t.id).shaderManager).execute({memory:{},globals:{colorTableSize:t.maxColorMapSize},textures:{colorTableTexture:t.colorTableTexture,indexTexture:t.gifFrameTexture,alphaTexture:i.texture,prevFrameTexture:t.prevFrame?t.prevFrame.texture:null},drawingTarget:t.currentFrameBuffer}),t.prevFrameBuffer&&ae(t.id).resouceManager.getLastingAllocator().dispose(t.prevFrameBuffer),t.prevFrameBuffer=ae(t.id).resouceManager.getLastingAllocator().allocate(t.screenWidth,t.screenHeight),t.prevFrame=new q(t.drawer,ae(t.id).shaderManager).execute({memory:{},globals:{},textures:{targetTexture:t.currentFrame.texture},drawingTarget:t.prevFrameBuffer})}))}},{key:"restorePrevDisposal",value:function(){this.currentFrame=this.disposalPrevFrame,this.prevFrame=this.disposalPrevFrame}},{key:"drawToScreen",value:function(){var e=this;ae(this.id).resouceManager.allocateFrameDrawingTarget((function(r){var t=e.currentFrame,n=new j(e.drawer,ae(e.id).shaderManager).execute({memory:{},globals:{},textures:{targetTexture:t.texture},drawingTarget:r.allocate(e.screenWidth,e.screenHeight)}),a=new V(e.drawer,ae(e.id).shaderManager).execute({memory:{},globals:{},textures:{targetTexture:t.texture},drawingTarget:r.allocate(e.screenWidth,e.screenHeight)});t=new $(e.drawer,ae(e.id).shaderManager).execute({memory:{},globals:{alpha:.7},textures:{background:n.texture,foreground:a.texture},drawingTarget:r.allocate(e.screenWidth,e.screenHeight)}),e.drawer.getNumberOfDrawCalls(t.texture)%2==1&&(t=new O(e.drawer,ae(e.id).shaderManager).execute({memory:{},globals:{},textures:{targetTexture:t.texture},drawingTarget:r.allocate(e.screenWidth,e.screenHeight)})),new z(e.drawer,ae(e.id).shaderManager).execute({memory:{},globals:{},textures:{targetTexture:t.texture}})})),this.drawer.endFrame(),ae(this.id).resouceManager.endFrame(),this.drawer.startFrame(),ae(this.id).resouceManager.startFrame()}},{key:"drawToAlphaTexture",value:function(e,r){var t,n={screenHeight:this.screenHeight,transperancyIndex:null!==(t=r.graphicControl)&&void 0!==t&&t.isTransparent?r.graphicControl.transparentColorIndex:512,alphaSquarCoord:[r.imageLeft,r.imageTop,r.imageWidth,r.imageHeight]};return new X(this.drawer,ae(this.id).shaderManager).execute({memory:{},globals:n,textures:{gifFrame:this.gifFrameTexture},drawingTarget:e})}},{key:"saveDisposalPrev",value:function(){this.disposalPrevFrameBuffer&&ae(this.id).resouceManager.getLastingAllocator().dispose(this.disposalPrevFrameBuffer),this.disposalPrevFrameBuffer=ae(this.id).resouceManager.getLastingAllocator().allocate(this.screenWidth,this.screenHeight),this.disposalPrevFrame=new q(this.drawer,ae(this.id).shaderManager).execute({memory:{},globals:{},textures:{targetTexture:this.currentFrame.texture},drawingTarget:this.disposalPrevFrameBuffer})}},{key:"getCanvasPixels",value:function(e){this.currentFrame&&this.currentFrame.readResultToBuffer(e)}},{key:"getPrevCanvasPixels",value:function(e){this.prevFrame&&this.prevFrame.readResultToBuffer(e)}}])}(),ue=function(){return(0,p.A)((function e(){(0,h.A)(this,e),this.gifs=[]}),[{key:"addGifToRender",value:function(e,r,t){var n=this,a={id:this.gifs.length},i={gifEntity:e,currentFrame:-1,algorithm:"GL"===t.algorithm?new oe(r,e.gif.screenDescriptor,e.gif.images,e.gif.colorMap,t.uncompress):new x(r,e.gif.screenDescriptor,e.gif.images,e.gif.colorMap,t.uncompress),timer:new v,canvas:r},o=i.gifEntity.gif.screenDescriptor,u=o.screenWidth,s=o.screenHeight;return i.canvas.width=u,i.canvas.height=s,i.canvas.style.width="".concat(u,"px"),i.canvas.style.height="".concat(s,"px"),this.gifs.push(i),i.gifEntity.gif.images.length?new Promise((function(e){return i.timer.once((function(){n.setFrame(a,0).then((function(){return e(a)}))}))})):Promise.resolve(a)}},{key:"setFrame",value:function(e,r){var t=this,n=this.gifs[e.id];return new Promise((function(e){r>-1&&r<n.gifEntity.gif.images.length&&r!==n.currentFrame?(n.timer.clear(),n.timer.once((function(){for(var a=0;a<r;a++)t.drawToTexture(n,a),t.performeDisposalMethod(n,a);n.currentFrame=r,t._drawFrame(n,n.currentFrame),e()}))):e()}))}},{key:"autoplayStart",value:function(e){var r=this,t=this.gifs[e.id];if(t.gifEntity.gif.images.length>1){var n,a=function(){var e,n=(t.currentFrame+1)%t.gifEntity.gif.images.length;t.timer.once(a,(null===(e=t.gifEntity.gif.images[n].graphicControl)||void 0===e?void 0:e.delayTime)||40),t.currentFrame=n,r._drawFrame(t,t.currentFrame)};return t.timer.once(a,(null===(n=t.gifEntity.gif.images[t.currentFrame].graphicControl)||void 0===n?void 0:n.delayTime)||40),!0}return!1}},{key:"autoplayEnd",value:function(e){this.gifs[e.id].timer.clear()}},{key:"drawToTexture",value:function(e,r){var t,n=e.gifEntity.gif.images[r];console.log("frame = ",r),e.algorithm.drawToTexture(n,e.gifEntity.gif.colorMap),(null===(t=n.graphicControl)||void 0===t?void 0:t.disposalMethod)!==g.prev&&e.algorithm.saveDisposalPrev()}},{key:"drawToScreen",value:function(e){e.algorithm.drawToScreen()}},{key:"_drawFrame",value:function(e,r){this.drawToTexture(e,r),this.drawToScreen(e),this.performeDisposalMethod(e,r)}},{key:"performeDisposalMethod",value:function(e,r){var t;(null===(t=e.gifEntity.gif.images[r].graphicControl)||void 0===t?void 0:t.disposalMethod)===g.prev&&e.algorithm.restorePrevDisposal()}}])}(),se=t(487),ce=t.n(se);const le=t.p+"1f220a855cd1204e55a4d8f6748d6283.wasm";var fe=document.getElementById("main"),ge=document.createElement("input");ge.type="file";var me=[],de=new ue;ge.addEventListener("change",(function(){var e=new FileReader;e.onload=function(e){var r=function(e){var r=String.fromCharCode,t=new Uint8Array(e);if(t[0]===n.G&&t[1]===n.I&&t[2]===n.F){var g=10*Number(r(t[3]))+Number(r(t[4])),h="GIF".concat(g).concat(r(t[5])),p=function(e){var r=new Uint8Array(e);return 0!==r[o.start+o.size-1]&&console.warn("Invalid Screen Descriptor section: last byte should be 0"),{screenWidth:r[o.start+0]|r[o.start+1]<<8,screenHeight:r[o.start+2]|r[o.start+3]<<8,M:r[o.start+4]>>7,cr:1+((112&r[o.start+4])>>4),pixel:1+(7&r[o.start+4]),background:r[o.start+5]}}(e),v=u.start,T=null;p.M&&(T=function(e,r){return c(e,u.start,r)}(e,p.pixel),v+=T.entriesCount*u.entriesCount);for(var x=function(e,r){for(var t=new Uint8Array(e),n=[],o=null,g=null;r<t.byteLength&&-1!==r;)switch(t[r]){case a.blockLabel:if(r++,t[r++]===a.graphicControl){var h=t[r];o=m(e,r+1),r=r+h+1}else r=f(e,r);break;case i.imageSeparator:g=l(e,r),n.push(g),r+=s.size,g.M&&(g.colorMap=c(e,r,g.pixel),r+=g.colorMap.entriesCount*u.entriesCount),o&&(g.graphicControl=o),g.compressedData=t.subarray(r,d(e,r)),g.startPointer=r,r+=g.compressedData.byteLength;break;default:r++}return{images:n,blockEnd:r}}(e,v),w=x.images,y=x.blockEnd;y<t.length&&t[y]!==i.gifTermination;)y++;return y>t.length&&console.warn("GIF doens`t terminate with proper symbol. It may be corrapted."),{signature:h,version:g,screenDescriptor:p,colorMap:T,images:w,buffer:t}}}(e.target.result);if(r){var t=function(e){return{gif:e}}(r);(function(e){var r,t,n,a,i,o=0;return(r=e.buffer,t=e.screenDescriptor.screenWidth*e.screenDescriptor.screenHeight,n=Math.floor((r.byteLength+t+131072)/65536)+1,a=new WebAssembly.Memory({initial:n,maximum:n}),i=new Uint8Array(a.buffer),ce()({wasmMemory:a,locateFile:function(e){return e.endsWith(".wasm")?le:e}}).then((function(e){var n=e.cwrap("lzw_uncompress","void",["number","number","number","number"]),a=e._malloc(r.byteLength),o=e._malloc(t);return i.set(r,a),{module:e,lzw_uncompress:n,gifStartPointer:a,outBuffer:i.subarray(o,o+t),outStartPointer:o}}))).then((function(e){return o=e.gifStartPointer,{lzw_uncompress:function(r){e.lzw_uncompress(o+r.startPointer,r.compressedData.length,e.outStartPointer,e.outBuffer.length)},out:e.outBuffer}}))})(t.gif).then((function(e){var r=document.createElement("div"),n=document.createElement("div"),a=document.createElement("canvas"),i=document.createElement("span");i.innerText="Render Type - GL",n.append(a),n.append(i),r.append(n),de.addGifToRender(t,a,{uncompress:e,algorithm:"GL"}).then((function(e){de.autoplayStart(e)}));var o=document.createElement("div"),u=document.createElement("canvas"),s=document.createElement("span");s.innerText="Render Type - SoftWare",o.append(u),o.append(s),r.append(o),de.addGifToRender(t,u,{uncompress:e,algorithm:"Software"}).then((function(e){de.autoplayStart(e)})),fe.append(r),console.log("new gif: ",t),me.push(t)}))}},e.readAsArrayBuffer(this.files[0])}),!1),fe.append(ge)}},t={};function n(e){var a=t[e];if(void 0!==a)return a.exports;var i=t[e]={exports:{}};return r[e](i,i.exports,n),i.exports}n.m=r,e=[],n.O=(r,t,a,i)=>{if(!t){var o=1/0;for(l=0;l<e.length;l++){for(var[t,a,i]=e[l],u=!0,s=0;s<t.length;s++)(!1&i||o>=i)&&Object.keys(n.O).every((e=>n.O[e](t[s])))?t.splice(s--,1):(u=!1,i<o&&(o=i));if(u){e.splice(l--,1);var c=a();void 0!==c&&(r=c)}}return r}i=i||0;for(var l=e.length;l>0&&e[l-1][2]>i;l--)e[l]=e[l-1];e[l]=[t,a,i]},n.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return n.d(r,{a:r}),r},n.d=(e,r)=>{for(var t in r)n.o(r,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var r=n.g.document;if(!e&&r&&(r.currentScript&&"SCRIPT"===r.currentScript.tagName.toUpperCase()&&(e=r.currentScript.src),!e)){var t=r.getElementsByTagName("script");if(t.length)for(var a=t.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=t[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{var e={792:0};n.O.j=r=>0===e[r];var r=(r,t)=>{var a,i,[o,u,s]=t,c=0;if(o.some((r=>0!==e[r]))){for(a in u)n.o(u,a)&&(n.m[a]=u[a]);if(s)var l=s(n)}for(r&&r(t);c<o.length;c++)i=o[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(l)},t=self.webpackChunkcustom_gif=self.webpackChunkcustom_gif||[];t.forEach(r.bind(null,0)),t.push=r.bind(null,t.push.bind(t))})();var a=n.O(void 0,[121],(()=>n(674)));a=n.O(a)})();